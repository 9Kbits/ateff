namespace = islamate
character_event = {
	id = islamate.1
	desc = EVTDESC_islamate1
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	
	min_age = 16
	prisoner = no
	only_playable = yes
	capable_only = yes
	only_independent = yes
	
	trigger = {
		has_dlc = "Sword of Islam"
		capital_scope = {
			region = custom_west_coast
		}
		OR = {
			religion_group = christian
			religion_group = cult_of_saints
			religion_group = latter_day_saints
			religion_group = jewish_group
			religion_group = pacific
		}
		NOT = { trait = zealous } #obvious
		NOT = { is_inaccessible_trigger = yes }
	}
	
	mean_time_to_happen = {
		months = 750
	}
	
	immediate = {
		create_character = {
			random_traits = yes
			culture = khalifi
			dynasty = culture
			religion = imamite
			female = no
			age = 30
			trait = charismatic_negotiator
			attributes = {
				diplomacy = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			character_event = { id = misc.3 } # Diversity
			character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = theologian
			remove_trait = mystic
			random_list = {
				70 = {
					add_trait = poet
				}
				30 = {
					add_trait = poet
					add_trait = shrewd
				}
			}
			save_event_target_as = muslim_courtier
		}
	}
	
	option = {
		name = EVTOPTA_SoA_200
		custom_tooltip = {
			text = muslim_courtier_tooltip
		}
	}
}
character_event = {
	id = islamate.2
	desc = EVTDESC_islamate2
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	
	min_age = 16
	prisoner = no
	only_playable = yes
	capable_only = yes
	only_independent = yes
	
	trigger = {
		has_dlc = "Sword of Islam"
		capital_scope = {
			OR = {
				region = world_southeast
				region = world_gulf_coast
			}
		}
		OR = {
			religion_group = christian
			religion_group = cult_of_saints
			religion_group = oldworld
			religion_group = latter_day_saints
			religion_group = jewish_group
		}
		NOT = { trait = zealous } #obvious
		NOT = { is_inaccessible_trigger = yes }
	}
	
	mean_time_to_happen = {
		months = 750
	}
	
	immediate = {
		create_character = {
			random_traits = yes
			culture = neomoor
			dynasty = culture
			religion = orientalist
			female = no
			age = 30
			trait = scholarly_theologian
			attributes = {
				learning = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			character_event = { id = misc.3 } # Diversity
			character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = theologian
			remove_trait = poet
			random_list = {
				70 = {
					add_trait = mystic
					add_trait = physician
				}
				30 = {
					add_trait = mystic
					add_trait = physician
					add_trait = shrewd
				}
			}
			save_event_target_as = muslim_courtier
		}
	}
	
	option = {
		name = EVTOPTA_SoA_200
		custom_tooltip = {
			text = muslim_courtier_tooltip
		}
	}
}
character_event = {
	id = islamate.3
	desc = EVTDESC_islamate3
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	
	min_age = 16
	prisoner = no
	only_playable = yes
	capable_only = yes
	only_independent = yes
	
	trigger = {
		has_dlc = "Sword of Islam"
		capital_scope = {
			region = custom_west_coast
		}
		OR = {
			religion_group = christian
			religion_group = cult_of_saints
			religion_group = latter_day_saints
			religion_group = jewish_group
			religion_group = pacific
		}
		NOT = { trait = zealous } #obvious
		NOT = { is_inaccessible_trigger = yes }
	}
	
	mean_time_to_happen = {
		months = 750
	}
	
	immediate = {
		create_character = {
			random_traits = yes
			culture = tehrangeleno
			dynasty = culture
			religion = imamite
			female = no
			age = 30
			trait = fortune_builder
			attributes = {
				stewardship = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			character_event = { id = misc.3 } # Diversity
			character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = theologian
			remove_trait = mystic
			random_list = {
				70 = {
					add_trait = administrator
				}
				30 = {
					add_trait = administrator
					add_trait = shrewd
				}
			}
			save_event_target_as = muslim_courtier
		}
	}
	
	option = {
		name = EVTOPTA_SoA_200
		custom_tooltip = {
			text = muslim_courtier_tooltip
		}
	}
}

character_event = {
	id = islamate.4
	desc = EVTDESC_islamate4
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	
	min_age = 16
	prisoner = no
	only_playable = yes
	capable_only = yes
	only_independent = yes
	
	trigger = {
		has_dlc = "Sword of Islam"
		capital_scope = {
			region = custom_great_lakes
		}
		OR = {
			religion_group = christian
			religion_group = latter_day_saints
			religion_group = jewish_group
		}
		NOT = { trait = zealous } #obvious
		NOT = { is_inaccessible_trigger = yes }
	}
	
	mean_time_to_happen = {
		months = 750
	}
	
	immediate = {
		create_character = {
			random_traits = yes
			culture = chiraqi
			dynasty = culture
			religion = traditionalist
			female = no
			age = 30
			trait = charismatic_negotiator
			attributes = {
				diplomacy = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			character_event = { id = misc.3 } # Diversity
			character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = theologian
			remove_trait = mystic
			random_list = {
				33 = {
					add_trait = trtrad
				}
				33 = {
					add_trait = trshia
				}
				33 = {
					add_trait = trsunni
				}
			}
			random_list = {
				70 = {
					add_trait = poet
				}
				30 = {
					add_trait = poet
					add_trait = shrewd
				}
			}
			save_event_target_as = muslim_courtier
		}
	}
	
	option = {
		name = EVTOPTA_SoA_200
		custom_tooltip = {
			text = muslim_courtier_tooltip
		}
	}
}
character_event = {
	id = islamate.5
	desc = EVTDESC_islamate5
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	
	min_age = 16
	prisoner = no
	only_playable = yes
	capable_only = yes
	only_independent = yes
	
	trigger = {
		has_dlc = "Sword of Islam"
		capital_scope = {
			region = custom_great_lakes
		}
		OR = {
			religion_group = christian
			religion_group = latter_day_saints
			religion_group = jewish_group
		}
		NOT = { trait = zealous } #obvious
		NOT = { is_inaccessible_trigger = yes }
	}
	
	mean_time_to_happen = {
		months = 750
	}
	
	immediate = {
		create_character = {
			random_traits = yes
			culture = prodnanici
			dynasty = culture
			religion = traditionalist
			female = no
			age = 30
			trait = intricate_webweaver
			attributes = {
				intrigue = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			character_event = { id = misc.3 } # Diversity
			character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = theologian
			remove_trait = mystic
			random_list = {
				33 = {
					add_trait = trtrad
				}
				33 = {
					add_trait = trshia
				}
				33 = {
					add_trait = trsunni
				}
			}
			random_list = {
				70 = {
					add_trait = schemer
				}
				30 = {
					add_trait = schemer
					add_trait = shrewd
				}
			}
			save_event_target_as = muslim_courtier
		}
	}
	
	option = {
		name = EVTOPTA_SoA_200
		custom_tooltip = {
			text = muslim_courtier_tooltip
		}
	}
}
character_event = {
	id = islamate.7
	desc = "EVTDESC_imamitejihad"
	picture = GFX_evt_open_book_hf
	border = GFX_event_normal_frame
	prisoner = no
	only_independent = yes
	trigger = {
		has_landed_title = d_imamite
		NOT = { has_global_flag = imamite_jihad_unlocked }
	}

	mean_time_to_happen = {
		days = 120
	}	

	option = {
		name = "EVTOPT_imamitejihad"
		trigger = {
			religion = imamite
		}
		hidden_tooltip = {
			set_global_flag = imamite_jihad_unlocked
		}	
	}

}

character_event = {
	id = islamate.8
	desc = EVTDESC_islamate8
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	
	min_age = 16
	prisoner = no
	only_playable = yes
	capable_only = yes
	only_independent = yes
	
	trigger = {
		has_dlc = "Sword of Islam"
		capital_scope = {
			region = custom_central_america
		}
		OR = {
			religion_group = christian
			religion_group = cult_of_saints
			religion_group = jewish_group
		}
		NOT = { trait = zealous } #obvious
		NOT = { is_inaccessible_trigger = yes }
	}
	
	mean_time_to_happen = {
		months = 750
	}
	
	immediate = {
		create_character = {
			random_traits = yes
			culture = filastino
			dynasty = culture
			religion = traditionalist
			female = no
			age = 30
			trait = scholarly_theologian
			attributes = {
				learning = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			character_event = { id = misc.3 } # Diversity
			character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = theologian
			remove_trait = mystic
			random_list = {
				33 = {
					add_trait = trtrad
				}
				33 = {
					add_trait = trshia
				}
				33 = {
					add_trait = trsunni
				}
			}
			random_list = {
				70 = {
					add_trait = mystic
					add_trait = physician
				}
				30 = {
					add_trait = mystic
					add_trait = physician
					add_trait = shrewd
				}
			}
			save_event_target_as = muslim_courtier
		}
	}
	
	option = {
		name = EVTOPTA_SoA_200
		custom_tooltip = {
			text = muslim_courtier_tooltip
		}
	}
}

character_event = {
	id = islamate.9
	desc = EVTDESC_islamate9
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	
	min_age = 16
	prisoner = no
	only_playable = yes
	capable_only = yes
	only_independent = yes
	
	trigger = {
		has_dlc = "Sword of Islam"
		capital_scope = {
			region = world_south_america
		}
		OR = {
			religion_group = christian
			religion_group = cult_of_saints
			religion_group = jewish_group
		}
		NOT = { trait = zealous } #obvious
		NOT = { is_inaccessible_trigger = yes }
	}
	
	mean_time_to_happen = {
		months = 750
	}
	
	immediate = {
		create_character = {
			random_traits = yes
			culture = sranan
			dynasty = culture
			religion = traditionalist
			female = no
			age = 30
			trait = fortune_builder
			attributes = {
				stewardship = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			character_event = { id = misc.3 } # Diversity
			character_event = { id = misc.5 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = theologian
			remove_trait = mystic
			random_list = {
				70 = {
					add_trait = administrator
				}
				30 = {
					add_trait = administrator
					add_trait = shrewd
				}
			}
			save_event_target_as = muslim_courtier
		}
	}
	
	option = {
		name = EVTOPTA_SoA_200
		custom_tooltip = {
			text = muslim_courtier_tooltip
		}
	}
}

character_event = {
	id = islamate.10
	desc = EVTDESC_islamate10
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	
	min_age = 16
	prisoner = no
	only_playable = yes
	capable_only = yes
	only_independent = yes
	
	trigger = {
		has_dlc = "Sword of Islam"
		capital_scope = {
			region = world_caribbean
		}
		OR = {
			religion_group = christian
			religion_group = cult_of_saints
			religion_group = jewish_group
			religion = rastafarian
		}
		NOT = { trait = zealous } #obvious
		NOT = { is_inaccessible_trigger = yes }
	}
	
	mean_time_to_happen = {
		months = 750
	}
	
	immediate = {
		create_character = {
			random_traits = yes
			culture = calypsonian
			dynasty = culture
			religion = traditionalist
			female = no
			age = 30
			trait = charismatic_negotiator
			attributes = {
				diplomacy = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			character_event = { id = misc.3 } # Diversity
			character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = theologian
			remove_trait = mystic
			random_list = {
				70 = {
					add_trait = musician
				}
				30 = {
					add_trait = musician
					add_trait = shrewd
				}
			}
			save_event_target_as = muslim_courtier
		}
	}
	
	option = {
		name = EVTOPTA_SoA_200
		custom_tooltip = {
			text = muslim_courtier_tooltip
		}
	}
}
character_event = {
	id = islamate.12
	desc = "EVTDESC_ammondeath"
	picture = GFX_evt_lunatic_arabic
	border = GFX_event_intrigue_frame
	prisoner = no
	only_independent = yes
	has_character_flag = ammon_jaffar
	only_playable = yes

	mean_time_to_happen = {
		days = 100
	}	

	option = {
		name = "evtopt_ammondeath"
		hidden_tooltip = {
			death = { death_reason = death_murder_unknown }
			set_global_flag = ammondead
		}	
	}
}
character_event = {
	id = islamate.13
	hide_from = yes
	hide_window = yes
	has_character_flag = ali_ababwa
	has_global_flag = ammondead
	only_playable = yes

	mean_time_to_happen = {
		days = 1
	}	
	immediate = {
		clr_global_flag = ammondead
		add_trait = depressed
	}
}
character_event = {
	id = islamate.14
	desc = "EVTDESC_princeali1"
	picture = GFX_evt_carriage_arabic
	border = GFX_event_normal_frame
	prisoner = no
	only_independent = yes
	has_character_flag = ali_ababwa
	only_playable = yes

	mean_time_to_happen = {
		years = 2
	}	

	option = {
		name = "EVTOPT_brightstar"
		clr_character_flag = ali_ababwa
		add_trait = ambitious
		hidden_tooltip = {
			character_event = { id = islamate.15 days = 1 }
		}	
	}
}
character_event = {
	id = islamate.15
	desc = "EVTDESC_princeali2"
	picture = GFX_evt_battle_indo_aryan_group
	border = GFX_event_normal_frame
	is_triggered_only = yes

	option = {
		name = "EVTOPT_tenmendefinitely"
		add_trait = robust
		hidden_tooltip = {
			character_event = { id = islamate.16 days = 1 }
		}	
	}
}
character_event = {
	id = islamate.16
	desc = "EVTDESC_princeali3"
	picture = GFX_evt_large_army_indo_aryan_group
	border = GFX_event_normal_frame
	is_triggered_only = yes

	option = {
		name = "EVTOPT_handsomeishe"
		add_trait = fair
		add_trait = gregarious
		hidden_tooltip = {
			character_event = { id = islamate.17 days = 1 }
		}	
	}
}



character_event = {
	id = islamate.17
	desc = "EVTDESC_princeali4"
	picture = GFX_evt_emissary_indo_aryan_group
	border = GFX_event_normal_frame
	is_triggered_only = yes
	option = {
		name = "EVTDESC_princeali"
		create_character = {
			name = "Robin Smith"
			random_traits = yes
			culture = neomoor
			dynasty = culture
			religion = orientalist
			female = no
			age = 40
			trait = scholarly_theologian
			attributes = {
				intrigue = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			character_event = { id = misc.3 } # Diversity
			character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = theologian
			remove_trait = poet
			random_list = {
				70 = {
					add_trait = mystic
					add_trait = physician
				}
				30 = {
					add_trait = mystic
					add_trait = physician
					add_trait = shrewd
				}
			}
			save_event_target_as = muslim_courtier
		}
		remove_trait = depressed
		set_global_flag = orientalist_jihad_unlocked
		piety = 20
		capital_scope = {
			ROOT = {
				spawn_unit = {
					province = PREV
					owner = ROOT
					match_character = ROOT
					match_mult = 0.75
					attrition = 1.0
				}
			}
		}
	}
}

#Start of Ashura event chain
character_event = { 
	id = islamate.20
	desc = EVTDESC_ashura_1
	picture = GFX_evt_imam
	border = GFX_event_religious_frame
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = ashura_in_progress
	}
	
	immediate = {
		hidden_tooltip = { character_event = { id = islamate.21 days = 1 } }
	}
	
	option = { #event 1 happens, then event 2 happens 2 days later, then event 3 happens 3 days later, then event 4 happens another 3 days later, then event 5 happens a day after that. 1+2 = 3, 3+3 = 6, 6+3 = 9, 9+1 = 10. makes sense.
		name = EVTOPTA_ashura_1
		custom_tooltip = { text = TXT_ashura_begins }
	}
}

#Ashura Day 1
character_event = { 
	id = islamate.21
	desc = EVTDESC_ashura_2
	picture = GFX_evt_melee_arabic
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = ashura_in_progress
	}
	
	immediate = {
		hidden_tooltip = { character_event = { id = islamate.22 days = 4 } }
	}
	
	option = {
		name = EVTOPTA_ashura_2
		trigger = { NOT = { trait = craven } }
		if = {
			limit = {
				NOT { trait = brave }
			}
			random_list = {
				50 = { add_trait = brave }
				50 = { }
			}
			piety = 25
		}
		else_if = {
			limit = {
				trait = brave
			}
			piety = 30
		}
	}
	
	option = {
		name = EVTOPTB_ashura_2
		trigger = { NOT = { trait = brave } }
		if = {
			limit = {
				NOT { trait = craven }
			}
			add_trait = craven
			piety = -20
		}
		else_if = {
			limit = {
				trait = craven
			}
			piety = -20
		}
	}
}


character_event = { 
	id = islamate.22
	desc = EVTDESC_ashura_3
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = ashura_in_progress
	}
	
	immediate = {
		hidden_tooltip = { character_event = { id = islamate.23 days = 4 } }
	}
	
	option = {
		name = EVTOPTA_ashura_3
		trigger = {
			OR = {
				religion = alawiyya
				trait = zealous
			}
		}
		if = {
			limit = {
				NOT = { trait = zealous }
			}
			random_list = {
				50 = { add_trait = zealous }
				50 = { piety = 50 }
			}
		}
		else_if = {
			limit = {
				trait = zealous
			}
			piety = 100
		}
		if = {
			limit = {
				has_dlc = "Reapers"
			}
			random_list = {
				35 = { }
				50 = { add_trait = wounded }
				15 = { add_trait_severely_injured_effect = yes }
			}
		}
		else_if = {
			limit = {
				NOT = { has_dlc = "Reapers" }
			}
			random_list = {
				35 = { }
				50 = { add_trait = wounded }
				15 = { add_maimed_trait_effect = yes }
			}
		}
	}
	
	option = {
		name = EVTOPTB_ashura_3
		prestige = -50
		piety = 50
	}
}


character_event = { 
	id = islamate.23
	desc = EVTDESC_ashura_4
	picture = GFX_evt_market_arabic
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = ashura_in_progress
	}
	
	immediate = {
		hidden_tooltip = { character_event = { id = islamate.24 days = 1 } }
	}
	
	option = {
		name = EVTOPTA_ashura_4
		trigger = { NOT = { trait = greedy } }
		piety = 50
		wealth = -25
		random_list = {
			50 = { add_trait = charitable }
			50 = { }
		}
	}
	
	option = {
		name = EVTOPTB_ashura_4
		trigger = { NOT = { trait = charitable } }
		piety = -25
		random_list = {
			50 = { add_trait = greedy }
			50 = { }
		}
	}
}

character_event = { 
	id = islamate.24
	desc = EVTDESC_ashura_5
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = ashura_in_progress
	}
	
	immediate = {
		clr_character_flag = ashura_in_progress
		clr_character_flag = do_not_disturb
		clr_character_flag = recent_minor_decision
		set_character_flag = ashura_fast
	}
	
	immediate = {
		hidden_tooltip = { character_event = { id = islamate.25 days = 40 } }
	}
	
	option = {
		name = EVTOPTA_ashura_5
		random_list = {
			25 = {
				if = {
					limit = {
						NOT = { trait = brave }
					}
					add_trait = brave
				}
				else_if = {
					limit = {
						trait = brave
					}
					prestige = 50
				}
			}
			25 = {
				if = {
					limit = {
						NOT = { trait = ambitious }
					}
					add_trait = ambitious
				}
				else_if = {
					limit = {
						trait = ambitious
					}
					prestige = 50
				}
			}
			25 = {
				if = {
					limit = {
						NOT = { trait = zealous }
					}
					add_trait = zealous
				}
				else_if = {
					limit = {
						trait = zealous
					}
					prestige = 50
				}
			}
			25 = {
				prestige = 50
			}
		}
		hidden_tooltip = { add_character_modifier = { name = ashura_timer years = 3 } } 
	}
}

character_event = { 
	id = islamate.25
	desc = EVTDESC_ashura_6
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = ashura_fast
	}
	
	immediate = {
		clr_character_flag = ashura_fast
	}
	
	option = {
		name = EVTOPTA_ashura_6
		trigger = { war = no }
		if = {
			limit = {
				NOT = {
					has_dlc = "Reapers"
				}
			}
			add_trait = ill
		}
		if = {
			limit = {
				has_dlc = "Reapers"
			}
			add_symptom_effect = yes
		}
		piety = 30
	}
	
	option = {
		name = EVTOPTB_ashura_6
		trigger = { war = no }
		piety = -20
	}
	
	option = {
		name = EVTOPTC_ashura_6
		trigger = { war = yes }
	}
}

character_event = { 
	id = islamate.26
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		clr_character_flag = ashura_in_progress
		clr_character_flag = ashura_fast
		clr_character_flag = do_not_disturb
		clr_character_flag = recent_minor_decision
	}
}

# War interrupts Ashura
character_event = {
	id = islamate.27
	desc = EVTDESC_ashura_7
	picture = GFX_evt_moors
	border =  GFX_event_normal_frame_religious
	has_character_flag = ashura_in_progress
	war = yes
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = EVTOPTA_ashura_7
		wealth = 100
		piety = -50
		prestige = 25
		hidden_tooltip = { character_event = { id = islamate.26 } }
		hidden_tooltip = { add_character_modifier = { name = ashura_timer years = 3 } }
	}
}

#Muslims in Mexico
#will begin actually writing this event later
#Muslim in Mexico: a player ruler in a province somewhere in Chiapas will have an event called "A Muslim in Mexico" where one of the hidden traditionalists reveal themselves to the ruler.
#Then there will be multiple branches - its sort of a short event chain.
#One branch will have, for example, a conclusion where you allow the community to exist openly with no further benefits. You get a province modifier which we can name later (for now "Muslim Community") similar to the Jewish community modifier you can get in the base game.
#One branch will have you show more sympathy - you can recruit the courtier as a counselor or something, and you'll get ("thriving Muslim community") with stronger benefits than the normal one, and have a chance of gaining sympathy of Islam.
#One will have you openly convert to traditionalist, but at a cost of province unrest for (five? ten? fifteen?) years, and now your neighbors hate you because you are now an infidel.
#One will have you drive out the community, which will be a province debuff for like five years in exchange for piety
#I also want a follow up to the event if you do not convert but choose the other three options where a courtier will come to the court of the descendant of the ruler who first got it, and then offer the same choices, or in the case of being booted, ask to be allowed in.
#At which case you can come up with a "final solution" to the Muslim presence, or you can convert, or be sympathetic -same maluses and benefits would apply.

province_event = {
	id = islamate.30
	desc = EVTDESC_muslim_mexico_1
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_diplomacy
	
	trigger = {
		province_id = 1838
		NOR = {
			religion_group = muslim
			has_province_modifier = muslim_settlement
			has_province_modifier = thriving_muslim_settlement
			has_province_modifier = expelled_muslim_settlement
			has_global_flag = muslims_in_mexico
		}
	}
	
	mean_time_to_happen = {
		years = 10
	}
	
	immediate = {
		set_province_flag = muslim_mexico
		save_global_event_target_as = muslim_mexico
	}
	
	option = {
		name = EVTOPTA_muslim_mexico_1
		add_province_modifier = { name = muslim_settlement duration = -1 }
		hidden_tooltip = {
			holder_scope = {
				character_event = { id = islamate.31 days = 1 }
			}
		}
	}
}

character_event = {
	id = islamate.31
	desc = EVTDESC_muslim_mexico_2
	picture = GFX_evt_throne_room
	border = GFX_event_normal_frame_diplomacy
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_muslim_mexico_2
		piety = -15
		custom_tooltip = { text = TXT_EVTOPTA_muslim_mexico_2 }
		hidden_tooltip = { set_global_flag = muslims_in_mexico }
		
		any_demesne_province = {
			if = {
				limit = {
					has_province_flag = muslim_mexico
				}
				clr_province_flag = muslim_mexico
				clear_global_event_target = muslim_mexico
			}
		}
		
		ai_will_do = {
			factor = 25
			modifier = {
				trait = sympathy_islam
				factor = 2
			}
			modifier = {
				trait = charitable
				factor = 2
			}
			modifier = {
				trait = kind
				factor = 2
			}
		}
	}
	
	option = {
		name = EVTOPTB_muslim_mexico_2
		trigger = { NOT = { trait = zealous } }
		piety = -30
		
		random_list = {
			50 = { add_trait = sympathy_islam }
			50 = { }
		}
		
		create_character = {
			random_traits = yes
			culture = ROOT
			dynasty = culture
			religion = traditionalist
			female = no
			age = 35
			trait = masterful_theologian
			trait = trtrad
			trait = theologian
			trait = zealous
			attributes = {
				learning = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			character_event = { id = misc.3 } # Diversity
			character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = mystic
		}
		
		any_demesne_province = {
			if = {
				limit = {
					has_province_flag = muslim_mexico
				}
				remove_province_modifier = muslim_settlement
				clr_province_flag = muslim_mexico
				clear_global_event_target = muslim_mexico
				add_province_modifier = { name = thriving_muslim_settlement duration = -1 }
			}
		}
		
		custom_tooltip = { text = TXT_EVTOPTB_muslim_mexico_2 }
		hidden_tooltip = { set_global_flag = muslims_in_mexico }
		
		ai_will_do = {
			factor = 25
			modifier = {
				trait = sympathy_islam
				factor = 2
			}
			modifier = {
				trait = charitable
				factor = 2
			}
			modifier = {
				trait = kind
				factor = 2
			}
		}
	}
	
	option = {
		name = EVTOPTC_muslim_mexico_2
		piety = 35
		
		any_demesne_province = {
			if = {
				limit = {
					has_province_flag = muslim_mexico
				}
				remove_province_modifier = muslim_settlement
				add_province_modifier = { name = expelled_muslim_settlement years = 3 }
			}
		}
		
		custom_tooltip = { text = TXT_EVTOPTC_muslim_mexico_2 }
		hidden_tooltip = { set_global_flag = muslims_in_mexico }
		hidden_tooltip = { set_character_flag = muslim_mexico_second_chance }
		
		ai_will_do = {
			factor = 25
			modifier = {
				trait = sympathy_islam
				factor = 0
			}
			modifier = {
				trait = cruel
				factor = 2
			}
			modifier = {
				trait = arbitrary
				factor = 2
			}
		}
	}
	
	option = {
		name = EVTOPTD_muslim_mexico_2
		trigger = {
			has_dlc = "The Sword of Islam" #why is there a the here
			NOT = { trait = zealous }
		}
		piety = 50
		religion = traditionalist
		add_trait = trtrad
		
		create_character = {
			random_traits = yes
			culture = ROOT
			dynasty = culture
			religion = traditionalist
			female = no
			age = 35
			trait = trtrad
			trait = masterful_theologian
			trait = theologian
			trait = zealous
			attributes = {
				learning = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			character_event = { id = misc.3 } # Diversity
			character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = mystic
		}
		
		any_demesne_province = {
			if = {
				limit = {
					has_province_flag = muslim_mexico
				}
				remove_province_modifier = muslim_settlement
				clr_province_flag = muslim_mexico
				clear_global_event_target = muslim_mexico
				religion = traditionalist
			}
		}
		
		random_demesne_province = {
			if = {
				limit = {
					NOR = {
						has_province_flag = muslim_mexico
						religion_group = muslim
					}
				}
				add_province_modifier = { name = religious_tension years = 3 }
			}
		}
		
		custom_tooltip = { text = TXT_EVTOPTD_muslim_mexico_2 }
		
		hidden_tooltip = {
			any_spouse = {
				religion = traditionalist
				add_trait = trtrad
			}
			any_child = {
				religion = traditionalist
				add_trait = trtrad
			}
		}
		
		hidden_tooltip = { set_global_flag = muslims_in_mexico }
		
		ai_will_do = {
			factor = 25
			modifier = {
				trait = sympathy_islam
				factor = 2
			}
			modifier = {
				trait = cynical
				factor = 2
			}
		}
	}
}

character_event = {
	id = islamate.32
	hide_window = yes
	is_triggered_only = yes

	has_character_flag = muslim_mexico_second_chance
	
	trigger = {
		any_demesne_province = {
			has_province_flag = muslim_mexico
		}
	}

	immediate = {
		current_heir = {
			set_character_flag = muslim_mexico_second_chance_heir
		}
	}
}

character_event = {
	id = islamate.33
	desc = EVTDESC_muslim_mexico_3
	picture = GFX_evt_throne_room
	border = GFX_event_normal_frame_diplomacy
	has_character_flag = muslim_mexico_second_chance_heir
	
	trigger = {
		NOT = { religion_group = muslim }
	}
	
	mean_time_to_happen = {
		years = 10
	}
	
	immediate = {
		clr_character_flag = muslim_mexico_second_chance_heir
	}
	
	option = {
		name = EVTOPTA_muslim_mexico_3
		piety = -15
		custom_tooltip = { text = TXT_EVTOPTA_muslim_mexico_3 }
		hidden_tooltip = { set_global_flag = muslims_in_mexico }
		
		any_demesne_province = {
			if = {
				limit = {
					has_province_flag = muslim_mexico
				}
				remove_province_modifier = expelled_muslim_settlement
				add_province_modifier = { name = muslim_settlement duration = -1 }
			}
		}
		
		ai_will_do = {
			factor = 25
			modifier = {
				trait = sympathy_islam
				factor = 2
			}
			modifier = {
				trait = charitable
				factor = 2
			}
			modifier = {
				trait = kind
				factor = 2
			}
		}
	}
	
	option = {
		name = EVTOPTB_muslim_mexico_3
		trigger = { NOT = { trait = zealous } }
		piety = -30
		
		random_list = {
			50 = { add_trait = sympathy_islam }
			50 = { }
		}
		
		create_character = {
			random_traits = yes
			culture = ROOT
			dynasty = culture
			religion = traditionalist
			female = no
			age = 35
			trait = masterful_theologian
			trait = trtrad
			trait = theologian
			trait = zealous
			attributes = {
				learning = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			character_event = { id = misc.3 } # Diversity
			character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = mystic
		}
		
		any_demesne_province = {
			if = {
				limit = {
					has_province_flag = muslim_mexico
				}
				remove_province_modifier = expelled_muslim_settlement
				add_province_modifier = { name = thriving_muslim_settlement duration = -1 }
			}
		}
		
		custom_tooltip = { text = TXT_EVTOPTB_muslim_mexico_3 }
		hidden_tooltip = { set_global_flag = muslims_in_mexico }
		
		
		ai_will_do = {
			factor = 25
			modifier = {
				trait = sympathy_islam
				factor = 2
			}
			modifier = {
				trait = charitable
				factor = 2
			}
			modifier = {
				trait = kind
				factor = 2
			}
			modifier = {
				trait = just
				factor = 2
			}
		}
	}
	
	option = {
		name = EVTOPTC_muslim_mexico_3
		piety = 35
		custom_tooltip = { text = TXT_EVTOPTC_muslim_mexico_3 }
		hidden_tooltip = { set_global_flag = muslims_in_mexico }
		
		ai_will_do = {
			factor = 25
			modifier = {
				trait = sympathy_islam
				factor = 0
			}
			modifier = {
				trait = cruel
				factor = 2
			}
			modifier = {
				trait = arbitrary
				factor = 2
			}
		}
	}
	
	option = {
		name = EVTOPTD_muslim_mexico_3
		trigger = {
			has_dlc = "The Sword of Islam" #why is there a the here
			NOT = { trait = zealous }
		}
		piety = 50
		religion = traditionalist
		add_trait = trtrad
		
		create_character = {
			random_traits = yes
			culture = ROOT
			dynasty = culture
			religion = traditionalist
			female = no
			age = 35
			trait = trtrad
			trait = masterful_theologian
			trait = theologian
			trait = zealous
			attributes = {
				learning = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			character_event = { id = misc.3 } # Diversity
			character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = mystic
		}
		
		any_demesne_province = {
			if = {
				limit = {
					has_province_flag = muslim_mexico
				}
				remove_province_modifier = expelled_muslim_settlement
				religion = traditionalist
			}
		}
		
		random_demesne_province = {
			if = {
				limit = {
					NOR = {
						has_province_flag = muslim_mexico
						religion_group = muslim
					}
				}
				add_province_modifier = { name = religious_tension years = 3 }
			}
		}
		
		custom_tooltip = { text = TXT_EVTOPTD_muslim_mexico_2 }
		
		hidden_tooltip = {
			any_spouse = {
				religion = traditionalist
				add_trait = trtrad
			}
			any_child = {
				religion = traditionalist
				add_trait = trtrad
			}
		}
		
		hidden_tooltip = { set_global_flag = muslims_in_mexico }
		

		ai_will_do = {
			factor = 25
			modifier = {
				trait = sympathy_islam
				factor = 2
			}
			modifier = {
				trait = cynical
				factor = 2
			}
		}
	}
}

character_event = {
	id = islamate.34
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		ROOT = {
			NOT = { religion_group = muslim }
			NOT = { has_character_flag = muslim_mexico_second_chance }
			NOT = { has_character_flag = muslim_mexico_second_chance_heir }
		}
		FROM = {
			tier = COUNT
			location = {
				OR = {
					has_province_modifier = muslim_settlement
					has_province_modifier = thriving_muslim_settlement
				}
			}
		}
	}
	
	immediate = {
		FROM = {
			location = {
				set_province_flag = muslim_mexico
				save_global_event_target_as = muslim_mexico
			}
		}
		ROOT = {
			character_event { id = islamate.35 }
		}
	}
}

character_event = {
	id = islamate.35
	desc = EVTDESC_muslim_mexico_4
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_diplomacy
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_muslim_mexico_4
		piety = -15
		random_list = {
			50 = { add_trait = sympathy_islam }
			50 = { }
		}
		
		any_demesne_province = {
			if = {
				limit = {
					has_province_flag = muslim_mexico
				}
				clr_province_flag = muslim_mexico
				clear_global_event_target = muslim_mexico
			}
		}
		
		ai_will_do = {
			factor = 25
			modifier = {
				trait = sympathy_islam
				factor = 2
			}
			modifier = {
				trait = zealous
				factor = 0.5
			}
			modifier = {
				trait = kind
				factor = 2
			}
			modifier = {
				trait = charitable
				factor = 2
			}
			modifier = {
				trait = just
				factor = 2
			}
		}
	}
	
	option = {
		name = EVTOPTB_muslim_mexico_4
		piety = 30
		any_demesne_province = {
			if = {
				limit = {
					has_province_flag = muslim_mexico
				}
				clr_province_flag = muslim_mexico
				clear_global_event_target = muslim_mexico
				remove_province_modifier = muslim_settlement
				remove_province_modifier = thriving_muslim_settlement
				add_province_modifier = { name = expelled_muslim_settlement years = 3 }
			}
		}
		
		ai_will_do = {
			factor = 25
			modifier = {
				trait = sympathy_islam
				factor = 0
			}
			modifier = {
				trait = zealous
				factor = 2
			}
			modifier = {
				trait = cruel
				factor = 2
			}
			modifier = {
				trait = arbitrary
				factor = 2
			}
		}
		
		hidden_tooltip = { set_character_flag = muslim_mexico_second_chance }
	}
}

province_event = {
	id = islamate.36
	hide_window = yes
	
	trigger = {
		OR = {
			has_province_modifier = muslim_settlement
			has_province_modifier = thriving_muslim_settlement
			has_province_modifier = expelled_muslim_settlement
		}
		religion_group = muslim
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		remove_province_modifier = muslim_settlement
		clear_global_event_target = muslim_mexico
		remove_province_modifier = thriving_muslim_settlement
		remove_province_modifier = expelled_muslim_settlement
	}
}

character_event = {
	id = islamate.37
	hide_window = yes
	is_triggered_only = yes
	
	only_rulers = yes
	
	trigger = {
		has_landed_title = k_papal_state
		is_alternate_start = no
	}
	
	option = {
		118 = {
			add_province_modifier = { name = expelled_muslim_settlement years = 1 }
		}
	}
}

#Revivalist events
character_event = {	
	id = islamate.40
	desc = EVTDESC_revivalist_1
	picture = GFX_evt_merchant_ship_at_sea_republic
	border = GFX_event_normal_frame_diplomacy
	only_independent = yes
	religion = traditionalist
	hide_from = yes
	
	trigger = {
		year = 2700 #30 years after game start, more or less
		NOT = { has_global_flag = wahhab_himself }
		capital_scope = {
			region = custom_atlantic
			port = yes
		}
	}

	mean_time_to_happen = {
		years = 5
		modifier = {
			factor = 0.5
			ai = yes
		}
	}
		
	immediate = {
		set_global_flag = wahhab_himself
	}
	
	option = {
		name = EVTOPTA_revivalist_1
		custom_tooltip = { text = TXT_EVTOPTA_revivalist_1 }
		hidden_tooltip = { character_event = { id = islamate.41 days = 1 } }
	}
}

character_event = {	
	id = islamate.41
	desc = EVTDESC_revivalist_2
	picture = GFX_evt_throne_room_arabic
	border = GFX_event_normal_frame_diplomacy
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_revivalist_2
		create_character = {
			random_traits = no
			name = "Abdullah"
			culture = moroccan
			dynasty = 1666097
			religion = traditionalist
			female = no
			age = 40
			trait = masterful_theologian
			trait = trsunni
			trait = ugly
			trait = shrewd
			trait = quick
			trait = mystic
			trait = physician
			trait = hafiz
			trait = brave
			attributes = {
				learning = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			character_event = { id = misc.3 } # Diversity
			character_event = { id = misc.4 } # Physique
			save_event_target_as = wahhab_himself
			set_secret_religion = revivalist
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = mystic
		}
		hidden_tooltip = { character_event = { id = islamate.42 months = 1 } }
	}
	
	option = {
		name = EVTOPTB_revivalist_2
		custom_tooltip = { text = TXT_EVTOPTB_revivalist_2 }
		hidden_tooltip = { character_event = { id = islamate. months = 5 } } #cuts straight to uprising event
	}
}

character_event = {	
	id = islamate.42
	desc = EVTDESC_revivalist_3
	picture = GFX_evt_council_arabic
	border = GFX_event_normal_frame_diplomacy
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_revivalist_3
		custom_tooltip = { text = TXT_EVTOPTA_revivalist_3 }
		hidden_tooltip = { character_event = { id = islamate.43 months = 1 } }
	}
}

character_event = {	
	id = islamate.43
	desc = EVTDESC_revivalist_4
	picture = GFX_evt_eavesdropping
	border = GFX_event_normal_frame_diplomacy
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_revivalist_4
		custom_tooltip = { text = TXT_EVTOPTA_revivalist_4 }
		hidden_tooltip = { character_event = { id = islamate.44 months = 1 } }
	}
	
	option = {
		name = EVTOPTB_revivalist_4
		custom_tooltip = { text = TXT_EVTOPTB_revivalist_4 }
		hidden_tooltip = { character_event = { id = islamate.44 months = 1 } }
	}
	
	option = {
		name = EVTOPTC_revivalist_4
		event_target:wahhab_himself = {
			clear_secret_religion = revivalist
			religion = revivalist
			add_trait = zealous
			imprison = ROOT
		}
		custom_tooltip = { text = TXT_EVTOPTC_revivalist_4 }
		hidden_tooltip = { narrative_event = { id = islamate. months = 1 } } #message of revival, will be narrative event
	}
}

#this event file left unfinished, because i am hungry