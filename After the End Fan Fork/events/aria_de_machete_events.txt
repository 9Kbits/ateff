namespace = machete

# Choose new gender school after reformation
character_event = {
	id = machete.1
	desc = EVTDESC_machete_choose_gender_ref
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_religion
	religion = aria_de_machete_reformed

	trigger = {
		NOT = { trait = machete_male_ref }
		NOT = { trait = machete_female+ref }
		OR = {
			trait = machete_male
			trait = machete_female
		}
		NOT = {
			has_alternate_start_parameter = { key = religion_names value = random }
		}
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	option = {
		name = EVTOPT_machete_ref_male
		hidden_tooltip = {
			remove_trait = machete_male
			remove_trait = machete_female
		}
		add_trait = machete_male_ref
		if = {
			limit = {
				NOR = {
					has_religion_feature = religion_feature_aria_de_machete
					has_religion_feature = religion_equal
				}
				primary_title = {
					revoke_law = cognatic_succession
					revoke_law = agnatic_succession
					revoke_law = true_cognatic_succession
					revoke_law = enatic_succession
					revoke_law = enatic_cognatic_succession
					add_law = agnatic_succession
				}
			}
		}
		if = {
			limit = {
				OR = {
					has_religion_feature = religion_feature_aria_de_machete
					has_religion_feature = religion_equal
				}
				primary_title = {
					revoke_law = cognatic_succession
					revoke_law = agnatic_succession
					revoke_law = true_cognatic_succession
					revoke_law = enatic_succession
					revoke_law = enatic_cognatic_succession
					add_law = cognatic_succession
				}
			}
		}
		ai_chance = {
			factor = 1
		}
	}
	
	option = {
		name = EVTOPT_machete_ref_female
		hidden_tooltip = {
			remove_trait = machete_male
			remove_trait = machete_female
		}
		add_trait = machete_female_ref
		if = {
			limit = {
				NOR = {
					has_religion_feature = religion_feature_aria_de_machete
					has_religion_feature = religion_equal
				}
				primary_title = {
					revoke_law = cognatic_succession
					revoke_law = agnatic_succession
					revoke_law = true_cognatic_succession
					revoke_law = enatic_succession
					revoke_law = enatic_cognatic_succession
					add_law = enatic_succession
				}
			}
		}
		if = {
			limit = {
				OR = {
					has_religion_feature = religion_feature_aria_de_machete
					has_religion_feature = religion_equal
				}
				primary_title = {
					revoke_law = cognatic_succession
					revoke_law = agnatic_succession
					revoke_law = true_cognatic_succession
					revoke_law = enatic_succession
					revoke_law = enatic_cognatic_succession
					add_law = enatic_cognatic_succession
				}
			}
		}
		ai_chance = {
			factor = 1
		}
	}	
}

# Choose lore school when unreformed
character_event = {
	id = machete.2
	desc = EVTDESC_machete_choose_gender
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	religion = aria_de_machete

	trigger = {
		NOT = {
			has_alternate_start_parameter = { key = religion_names value = random }
		}
	}
	
	option = {
		name = EVTOPT_machete_ref_male
		hidden_tooltip = {
			remove_trait = machete_male
			remove_trait = machete_female
		}
		add_trait = machete_male
		if = {
			limit = {
				NOR = {
					has_law = agnatic_succession
					has_law = cognatic_succession
				}
				primary_title = {
					revoke_law = cognatic_succession
					revoke_law = agnatic_succession
					revoke_law = true_cognatic_succession
					revoke_law = enatic_succession
					revoke_law = enatic_cognatic_succession
					add_law = agnatic_succession
				}
			}
		}
		ai_chance = {
			factor = 1
		}
	}
	
	option = {
		name = EVTOPT_machete_ref_female
		hidden_tooltip = {
			remove_trait = machete_male
			remove_trait = machete_female
		}
		add_trait = machete_female
		if = {
			limit = {
				NOR = {
					has_law = enatic_succession
					has_law = enatic_cognatic_succession
				}
				primary_title = {
					revoke_law = cognatic_succession
					revoke_law = agnatic_succession
					revoke_law = true_cognatic_succession
					revoke_law = enatic_succession
					revoke_law = enatic_cognatic_succession
					add_law = enatic_succession
				}
			}
		}
		ai_chance = {
			factor = 1
		}
	}	
}

# Choose lore school when reformed
character_event = {
	id = machete.3
	desc = EVTDESC_occult_choose_gender_ref
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	religion = aria_de_machete_reformed

	trigger = {
		NOT = {
			has_alternate_start_parameter = { key = religion_names value = random }
		}
	}
	
	option = {
		name = EVTOPT_occult_ref_mason
		hidden_tooltip = {
			remove_trait = machete_male_ref
			remove_trait = machete_female_ref
		}
		add_trait = machete_male_ref
		if = {
			limit = {
				NOR = {
					has_religion_feature = religion_feature_aria_de_machete
					has_religion_feature = religion_equal
				}
				primary_title = {
					revoke_law = cognatic_succession
					revoke_law = agnatic_succession
					revoke_law = true_cognatic_succession
					revoke_law = enatic_succession
					revoke_law = enatic_cognatic_succession
					add_law = agnatic_succession
				}
			}
		}
		if = {
			limit = {
				OR = {
					has_religion_feature = religion_feature_aria_de_machete
					has_religion_feature = religion_equal
				}
				primary_title = {
					revoke_law = cognatic_succession
					revoke_law = agnatic_succession
					revoke_law = true_cognatic_succession
					revoke_law = enatic_succession
					revoke_law = enatic_cognatic_succession
					add_law = cognatic_succession
				}
			}
		}
		ai_chance = {
			factor = 1
		}
	}
	
	option = {
		name = EVTOPT_occult_ref_oldones
		hidden_tooltip = {
			remove_trait = machete_male_ref
			remove_trait = machete_female_ref
		}
		add_trait = machete_female_ref
		if = {
			limit = {
				NOR = {
					has_religion_feature = religion_feature_aria_de_machete
					has_religion_feature = religion_equal
				}
				primary_title = {
					revoke_law = cognatic_succession
					revoke_law = agnatic_succession
					revoke_law = true_cognatic_succession
					revoke_law = enatic_succession
					revoke_law = enatic_cognatic_succession
					add_law = enatic_succession
				}
			}
		}
		if = {
			limit = {
				OR = {
					has_religion_feature = religion_feature_aria_de_machete
					has_religion_feature = religion_equal
				}
				primary_title = {
					revoke_law = cognatic_succession
					revoke_law = agnatic_succession
					revoke_law = true_cognatic_succession
					revoke_law = enatic_succession
					revoke_law = enatic_cognatic_succession
					add_law = enatic_cognatic_succession
				}
			}
		}
		ai_chance = {
			factor = 10
			modifier = { factor = 2 trait = brave }
			modifier = { factor = 2 trait = paranoid }
			modifier = { factor = 2 trait = envious }
			modifier = { factor = 2 trait = humble }
		}
	}
}

character_event = {
	id = machete.4
	hide_window = yes
	is_triggered_only = yes
	religion = aria_de_machete
	
	trigger = {
		NOT = { #immersion-breaking
			has_alternate_start_parameter = { key = religion_names value = random }
		}
	}
	
	immediate = {
		if = {
			limit = {
				trait = machete_male
			}
			primary_title = {
				revoke_law = cognatic_succession
				revoke_law = agnatic_succession
				revoke_law = true_cognatic_succession
				revoke_law = enatic_succession
				revoke_law = enatic_cognatic_succession
				add_law = agnatic_succession
			}
		}
		if = {
			limit = {
				trait = machete_female
			}
			primary_title = {
				revoke_law = cognatic_succession
				revoke_law = agnatic_succession
				revoke_law = true_cognatic_succession
				revoke_law = enatic_succession
				revoke_law = enatic_cognatic_succession
				add_law = enatic_succession
			}
		}
	}
}

narrative_event = {
	id = machete.5
	title = EVTTITLE_machete_5
	desc = EVTDESC_machete_5
	picture = GFX_evt_religious_exultation
	border = GFX_event_narrative_frame_religion
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = machete_praying_for_prosperity
	}
	
	option = {
		name = EVTOPTA_machete_5
		custom_tooltip = { text = TXT_EVTOPTA_machete_5 }
		hidden_tooltip = {
			random_list = {
				55 = {
					modifier = {
						factor = 1.5
						trait = just
					}
					modifier = {
						factor = 1.5
						trait = diligent
					}
					character_event = { id = machete.6 days = 14 random = 7 } #positive result
				}
				45 = {
					modifier = {
						factor = 1.5
						trait = arbitrary
					}
					modifier = {
						factor = 1.5
						trait = slothful
					}
					character_event = { id = machete.7 days = 14 random = 4 } #negative result
				}
			}
		}
	}
}

character_event = {
	id = machete.6
	desc = EVTDESC_machete_6
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = machete_praying_for_prosperity
	}
	
	option = {
		name = EVTOPTA_machete_6
		if = {
			limit = {
				is_nomadic = yes
			}
			add_character_modifier = { name = machete_blessing_nomad years = 5 }
		}
		if = {
			limit = {
				is_nomadic = no
			}
			add_character_modifier = { name = machete_blessing_notnomad years = 5 }
		}
	}
	
	after = {
		clr_character_flag = machete_praying_for_prosperity
	}
}

character_event = {
	id = machete.7
	desc = EVTDESC_machete_7
	picture = GFX_evt_bad_news
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = machete_praying_for_prosperity
	}
	
	option = {
		name = EVTOPTA_machete_6
		if = {
			limit = {
				is_nomadic = yes
			}
			add_character_modifier = { name = machete_curse_nomad years = 3 }
		}
		if = {
			limit = {
				is_nomadic = no
			}
			add_character_modifier = { name = machete_curse_notnomad years = 3 }
		}
	}
	
	after = {
		clr_character_flag = machete_praying_for_prosperity
	}
}

narrative_event = { #Ritual is performed
	id = machete.10
	title = EVTTITLE_machete_10
	desc = EVTDESC_machete_10
	picture = GFX_evt_performing_experiments
	border = GFX_event_narrative_frame_intrigue
	is_triggered_only = yes
	
	option = { 
        name = EVTOPTA_machete_10
        custom_tooltip = { text = EVTOPTA_machete_10_TT }
		hidden_tooltip = {
			random_list = {
				50 = {
					character_event = { id = machete.11 days = 7 random = 3 }
					modifier = {
						factor = 2
						event_target:machete_spell_lover = {
							trait = trusting
						}
					}
				}
				50 = {
					character_event = { id = machete.12 days = 7 random = 3 }
				}
			}
		}
    }
}

character_event = { #Spell Worked
	id = machete.11
	desc = EVTDESC_machete_11
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_machete_11
		reverse_opinion = {
        	who = event_target:machete_spell_lover
        	modifier = opinion_machete_infatuated
			years = 15
        }
	}
	
	option = {
		name = EVTOPTB_machete_11
		event_target:machete_spell_lover = {
			add_lover = event_target:machete_spell_caster
		}
	}
}

character_event = { #Spell Failed
	id = machete.12
	desc = EVTDESC_machete_12
	picture = GFX_evt_bad_news
	border = GFX_event_normal_frame_intrigue
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_machete_12
		reverse_opinion = {
        	who = event_target:machete_spell_lover
        	modifier = opinion_machete_disdain
			years = 10
        }
	}
}