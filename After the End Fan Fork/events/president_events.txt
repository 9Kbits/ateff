# Presidential elections 2.0
# Written by Sam. Feel free to reuse this code anywhere.
namespace = prez

################
# 1-99: Presidential elections
################

# President is dead
character_event = {
	id = prez.1
	desc = DEBUG
	is_triggered_only = yes # Triggered by on_death, on_yearly_pulse
	hide_window = yes
	religion = americanist
	
	trigger = {
		has_landed_title = d_americanist
		NOT = { has_global_flag = pres_election }
		NOT = { #immersion-breaking
			has_alternate_start_parameter = { key = religion_names value = random }
		}
	}
	
	immediate = {
		set_global_flag = pres_election
		set_global_flag = declare_candidacy
		any_playable_ruler = { # Inform players
			limit = { religion = americanist }
			character_event = { id = prez.3 }
		}
		k_papal_state = {
			clr_global_flag = force_candidate
			set_variable = { which = num_candidates value = 0 }
			holder_scope = {
				1050 = {
					province_event = { id = prez.700 days = 30 } # End candidate declaration period
				}
			}
		}
		d_americanist = {
			activate_title = { title = THIS status = no }
			unsafe_destroy_landed_title = THIS
		}
	}
	
	option = {
		name = DEBUG
	}
}

# President is dead
character_event = {
	id = prez.100
	desc = DEBUG
	is_triggered_only = yes # Triggered by on_death, on_yearly_pulse
	hide_window = yes
	
	trigger = {
		FROM = { title = d_americanist }
		NOT = { 
			trait = president
		}
		NOT = { has_global_flag = pres_election }
		NOT = { #immersion-breaking
			has_alternate_start_parameter = { key = religion_names value = random }
		}
	}
	
	immediate = {
		set_global_flag = pres_election
		set_global_flag = declare_candidacy
		any_player = { # Inform players
			limit = { religion = americanist }
			character_event = { id = prez.3 }
		}
		k_papal_state = {
			clr_global_flag = force_candidate
			set_variable = { which = num_candidates value = 0 }
			holder_scope = {
				1050 = {
					province_event = { id = prez.700 days = 30 } # End candidate declaration period
					province_event = { id = prez.9800 days = 180 } # Cleanup
				}
			}
		}
		d_americanist = {
			activate_title = { title = THIS status = no }
			unsafe_destroy_landed_title = THIS
		}
	}
	
	option = {
		name = DEBUG
	}
}

# Check if Presidency is vacant
character_event = {
	id = prez.2
	desc = DEBUG
	is_triggered_only = yes # called from on_yearly_pulse
	hide_window = yes
	only_rulers = yes
	
	trigger = {
		has_landed_title = k_papal_state
		OR = {
			NOT = { is_title_active = d_americanist }
			d_americanist = { has_holder = no }
		}
		NOT = { has_global_flag = pres_election }
	}
	
	option = {
		name = DEBUG
		set_global_flag = pres_election
		set_global_flag = declare_candidacy
		any_playable_ruler = { # Inform players
			limit = { religion = americanist }
			character_event = { id = prez.3 }
		}
		k_papal_state = {
			set_variable = { which = num_candidates value = 0 }
			holder_scope = {
				character_event = { id = prez.7 days = 30 } # End candidate declaration period
			}
		}
		d_americanist = {
			activate_title = { title = THIS status = no }
			unsafe_destroy_landed_title = THIS
		}
	}
}

# Notify players of President death
character_event = {
	id = prez.3
	picture = GFX_evt_death
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	desc = {
		text = prez.3.desc
		trigger = { d_americanist = { has_holder = yes } }
	}
	desc = {
		text = prez.3.descB
		trigger = { d_americanist = { has_holder = no } }
	}
	
	option = {
		name = prez.3.optA
		custom_tooltip = { text = prez.3.tooltip }
	}
}

# Notify players of a new candidate
character_event = {
	id = prez.4
	desc = prez.4.desc
	is_triggered_only = yes

	notification = yes
	
	option = {
		name = prez.4.optA
	}
}

# Notify players of a candidate dropping out or dying
character_event = {
	id = prez.5
	desc = {
		text = prez.5.desc
		trigger = { FROM = { is_alive = yes } }
	}
	desc = {
		text = prez.5.descB
		trigger = { FROM = { is_alive = no } }
	}
	is_triggered_only = yes

	notification = yes
	
	option = {
		name = prez.4.optA
	}
}

# Show player all candidates
character_event = {
	id = prez.6
	desc = prez.6.desc
	is_triggered_only = yes
	hide_from = yes
	
	option = {
		name = prez.6.optA
		any_independent_ruler = {
			any_realm_character = {
				limit = {
					religion = americanist
					trait = on_campaign
				}
				show_portrait = yes
				custom_tooltip = { text = TOOLTIPPRESIDENTCANDIDATE }
			}
		}
	}
}

province_event = {
	id = prez.700
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		k_papal_state = {
			holder_scope = {
				character_event = { id = prez.7 }
			}
		}
	}
}

# Candidate declaration deadline reached
character_event = {
	id = prez.7
	desc = DEBUG
	is_triggered_only = yes # triggered from prez.1
	hide_window = yes

	option = {
		name = DEBUG
		log = "prez.7, enough candidates, prez.9 in 30 days"
		trigger = {
			k_papal_state = { check_variable = { which = num_candidates value = 0.1 } }
		}
		set_global_flag = pres_election
		clr_global_flag = declare_candidacy
		clr_global_flag = force_candidate
		any_player = {
			limit = { religion = americanist }
			character_event = { id = prez.6 }
		}
		1050 = {
			province_event = { id = prez.9 days = 30 } # Thin out the field
		}
	}
	
	option = {
		log = "prez.7 not enough candidates"
		name = DEBUG
		trigger = {
			OR = {
				NOT = { k_papal_state = { check_variable = { which = num_candidates value = 0.1 } } }
				NOT = { has_global_flag = pres_election }
			}
		}
		if = {
			limit = {
				had_global_flag = {
					flag = force_candidate
					days = 30
				}
			}
			province_event = { id = prez.9800 } # Cleanup
		}
		else = {
			1050 = {
				province_event = { id = prez.700 days = 7 } # Thin out the field
			}
			set_global_flag = declare_candidacy
			set_global_flag = force_candidate
		}
	}
}

# Candidate drops out or dies - clear flags, notify player
character_event = {
	id = prez.8
	desc = DEBUG
	is_triggered_only = yes # Triggered from on_death, decision to drop out, other events
	hide_window = yes
	
	trigger = {
		trait = on_campaign
	}
	
	immediate = {
		remove_trait = on_campaign
		k_papal_state = { change_variable = { which = num_candidates value = -1 } }
		any_playable_ruler = { # Inform players
			limit = { religion = americanist }
			character_event = { id = prez.5 days = 1 }
		}
		set_character_flag = dropped_out
		clr_character_flag = pres_candidate
	}
	
	option = {
		name = DEBUG
	}
}

province_event = {
	id = prez.900
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		k_papal_state = {
			holder_scope = {
				character_event = { id = prez.9 }
			}
		}
	}
}

# Thin out the field
character_event = {
	id = prez.9
	desc = DEBUG
	is_triggered_only = yes # Triggered by prez.7
	hide_window = yes
	
	immediate = {
		log = "prez.9: [Root.GetBestName], prez.89 in 90 days"
		k_papal_state = {
			holder_scope = {
				1050 = { 
					province_event = { id = prez.8900 days = 90 } # Schedule voting
				}
				character_event = { id = prez.10 } # Thin out the field
			}
		}
	}
	
	option = {
		name = DEBUG
	}
}

province_event = {
	id = prez.1000
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		k_papal_state = {
			holder_scope = {
				character_event = { id = prez.10 }
			}
		}
	}
}

# Loop until there are only 4 candidates.
character_event = {
	id = prez.10
	desc = DEBUG
	is_triggered_only = yes
	hide_window = yes
	
	option = { # More than 4 candidates
		name = DEBUG
		log = "prez.10, more than 4 candidates"
		trigger = {
			k_papal_state = { check_variable = { which = num_candidates value = 4.1 } }
			has_global_flag = pres_election
		}
		k_papal_state = {
			holder_scope = {
				1050 = { 
					province_event = { id = prez.1000 days = 3 } # Continue loop
				}
				character_event = { id = prez.205 } # Hold opinion poll
			}
		}
	}
	
	option = { # 4 or less candidates
		name = DEBUG
		trigger = {
			OR = {
				NOT = { k_papal_state = { check_variable = { which = num_candidates value = 4.1 } } }
				NOT = { has_global_flag = pres_election }
			}
		}
		log = "prez.10, 4 or less candidates"
		set_global_flag = pres_voting #once 4 or less candidates have been selected, you can no longer drop out of the race via decision.
	}
}

# Decide whether to drop out or not
character_event = {
	id = prez.11
	desc = DEBUG
	is_triggered_only = yes
	hide_window = yes
	
	option = { # Drop out
		name = DEBUG
		ai_chance = {
			factor = 1
			modifier = {
				factor = 100
				NOR = {
					has_character_flag = 4th_place
					has_character_flag = 3rd_place
					has_character_flag = 2nd_place
					has_character_flag = 1st_place
				}
			}
			modifier = {
				factor = 5
				has_character_flag = 4th_place
			}
			modifier = {
				factor = 2
				has_character_flag = 3rd_place
			}
			modifier = {
				factor = 2
				k_papal_state = { check_variable = { which = num_candidates value = 8 } }
			}
			modifier = {
				factor = 0
				k_papal_state = { NOT = { check_variable = { which = num_candidates value = 4.1 } } }
			}
		}
		character_event = { id = prez.8 }
	}
	option = { # Stay
		name = DEBUG
		ai_chance = {
			factor = 1
			modifier = {
				factor = 5
				has_character_flag = 1st_place
			}
			modifier = {
				factor = 2
				has_character_flag = 2nd_place
			}
		}
	}
}

province_event = {
	id = prez.8900
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		k_papal_state = {
			holder_scope = {
				character_event = { id = prez.89 }
			}
		}
	}
}

#### VOTING
# Warn players about upcoming election
character_event = {
	id = prez.89
	desc = DEBUG
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		log = "prez.89: [Root.GetBestName], prez.91 in 30 days"
		any_player = {
			limit = { religion = americanist }
			character_event = { id = prez.90 }
		}
		k_papal_state = {
			holder_scope = {
				 1050 = { province_event = { id = prez.9100 days = 30 } }
			}
		}
	}
	
}

# Player warning
character_event = {
	id = prez.90
	desc = prez.90.desc
	picture = GFX_evt_rival_rulers
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	hide_from = yes
	
	option = {
		name = prez.90.optA
	}
}

province_event = {
	id = prez.9100
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		k_papal_state = {
			holder_scope = {
				character_event = { id = prez.91 }
			}
		}
	}
}


# Send out ballots
character_event = {
	id = prez.91
	desc = DEBUG
	is_triggered_only = yes
	
	immediate = {
		log = "prez.91: [Root.GetBestName]"
	}

	option = {
		name = DEBUG
		on_campaign = {
			limit = {
				has_character_flag = pres_candidate
			}
			save_event_target_as = c1
		}
		on_campaign = {
			limit = {
				has_character_flag = pres_candidate
				NOT = { event_target:c1 = { character = PREV } }
			}
			save_event_target_as = c2
		}
		on_campaign = {
			limit = {
				has_character_flag = pres_candidate
				NOT = { event_target:c1 = { character = PREV } }
				NOT = { event_target:c2 = { character = PREV } }
			}
			save_event_target_as = c3
		}
		on_campaign = {
			limit = {
				has_character_flag = pres_candidate
				NOT = { event_target:c1 = { character = PREV } }
				NOT = { event_target:c2 = { character = PREV } }
				NOT = { event_target:c3 = { character = PREV } }
			}
			save_event_target_as = c4
		}
		k_papal_state = {
			set_variable = { which = "c1_votes" value = 0 }
			set_variable = { which = "c2_votes" value = 0 }
			set_variable = { which = "c3_votes" value = 0 }
			set_variable = { which = "c4_votes" value = 0 }
		}
		
		any_independent_ruler = {
			any_realm_character = {
				limit = {
					religion = americanist
					is_adult = yes
				}
				letter_event = { id = prez.92 }
			}
		}
		1050 = {
			province_event = { id = prez.9300 days = 1 } # Count votes
			province_event = { id = prez.9800 days = 2 } # Cleanup
		}
	}
}

# The ballot
letter_event = {
	id = prez.92
	desc = prez.92.desc
	#picture = GFX_evt_recieve_letter
	border = GFX_event_letter_frame_religion
	is_triggered_only = yes
	hide_from = yes
	
	option = {
		name = prez.92.optA
		trigger = {
			ai = no
			event_target:c1 = { always = yes }
		}
		event_target:c1 = { custom_tooltip = { text = prez.92.tooltip } }
		hidden_tooltip = { k_papal_state = { change_variable = { which = "c1_votes" value = 1 } } }
	}
	
	option = {
		name = prez.92.optB
		trigger = {
			ai = no
			event_target:c2 = { always = yes }
		}
		event_target:c2 = { custom_tooltip = { text = prez.92.tooltip } }
		hidden_tooltip = { k_papal_state = { change_variable = { which = "c2_votes" value = 1 } } }
	}
	
	option = {
		name = prez.92.optC
		trigger = {
			ai = no
			event_target:c3 = { always = yes }
		}
		event_target:c3 = { custom_tooltip = { text = prez.92.tooltip } }
		hidden_tooltip = { k_papal_state = { change_variable = { which = "c3_votes" value = 1 } } }
	}
	
	option = {
		name = prez.92.optD
		trigger = {
			ai = no
			event_target:c4 = { always = yes }
		}
		event_target:c4 = { custom_tooltip = { text = prez.92.tooltip } }
		hidden_tooltip = { k_papal_state = { change_variable = { which = "c4_votes" value = 1 } } }
	}

	option = {
		trigger = {
			ai = yes
		}
		log = "----------------------------"
		log = "Evaluating for [Root.GetBestName]"
		set_variable = { which = newCandidate value = 0 }
		set_variable = { which = bestCandidate value = 0 }
		clr_character_flag = evaluated_candidate_c1
		clr_character_flag = evaluated_candidate_c2
		clr_character_flag = evaluated_candidate_c3
		clr_character_flag = evaluated_candidate_c4
		clr_character_flag = evaluated_candidate_c5
		clr_character_flag = evaluated_candidate_c6
		clr_character_flag = evaluated_candidate_c7
		clr_character_flag = evaluated_candidate_c8
		clr_character_flag = current_candidate_c1
		clr_character_flag = current_candidate_c2
		clr_character_flag = current_candidate_c3
		clr_character_flag = current_candidate_c4
		clr_character_flag = current_candidate_c5
		clr_character_flag = current_candidate_c6
		clr_character_flag = current_candidate_c7
		clr_character_flag = current_candidate_c8
		clr_character_flag = best_candidate_c1
		clr_character_flag = best_candidate_c2
		clr_character_flag = best_candidate_c3
		clr_character_flag = best_candidate_c4
		clr_character_flag = best_candidate_c5
		clr_character_flag = best_candidate_c6
		clr_character_flag = best_candidate_c7
		clr_character_flag = best_candidate_c8
		if = {
			limit = { NOT = { event_target:c1 = { always = yes } } }
			set_character_flag = evaluated_candidate_c1
		}
		if = {
			limit = { NOT = { event_target:c2 = { always = yes } } }
			set_character_flag = evaluated_candidate_c2
		}
		if = {
			limit = { NOT = { event_target:c3 = { always = yes } } }
			set_character_flag = evaluated_candidate_c3
		}
		if = {
			limit = { NOT = { event_target:c4 = { always = yes } } }
			set_character_flag = evaluated_candidate_c4
		}
		set_character_flag = evaluated_candidate_c5
		set_character_flag = evaluated_candidate_c6
		set_character_flag = evaluated_candidate_c7
		set_character_flag = evaluated_candidate_c8
		if = {
			limit = { NOT = { has_character_flag = evaluated_candidate_c1 } }
			event_target:c1 = { save_event_target_as = new_candidate }
			set_character_flag = current_candidate_c1
			log = "Current candidate c1: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { NOT = { has_character_flag = evaluated_candidate_c2 } }
			event_target:c2 = { save_event_target_as = new_candidate }
			set_character_flag = current_candidate_c2
			log = "Current candidate c2: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { NOT = { has_character_flag = evaluated_candidate_c3 } }
			event_target:c3 = { save_event_target_as = new_candidate }
			set_character_flag = current_candidate_c3
			log = "Current candidate c3: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { NOT = { has_character_flag = evaluated_candidate_c4 } }
			event_target:c4 = { save_event_target_as = new_candidate }
			set_character_flag = current_candidate_c4
			log = "Current candidate c4: [new_candidate.GetBestName]"
		}
		calculate_candidate_score = yes
		log = "[new_candidate.GetBestName]: [Root.newCandidate.GetValue] best candidate: [Root.bestCandidate.GetValue]"
		set_variable = { which = bestCandidate which = newCandidate }
		if = {
			limit = { has_character_flag = current_candidate_c1 }
			set_character_flag = evaluated_candidate_c1
			set_character_flag = best_candidate_c1
			log = "new best candidate c1: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { has_character_flag = current_candidate_c2 }
			set_character_flag = evaluated_candidate_c2
			set_character_flag = best_candidate_c2
			log = "new best candidate c2: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { has_character_flag = current_candidate_c3 }
			set_character_flag = evaluated_candidate_c3
			set_character_flag = best_candidate_c3
			log = "new best candidate c3: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { has_character_flag = current_candidate_c4 }
			set_character_flag = evaluated_candidate_c4
			set_character_flag = best_candidate_c4
			log = "new best candidate c4: [new_candidate.GetBestName]"
		}
		evaluate_candidate = yes
		evaluate_candidate = yes
		evaluate_candidate = yes
		if = {
			limit = { has_character_flag = best_candidate_c1 }
			log = "best candidate c1: [c1.GetBestName]"
			k_papal_state = { change_variable = { which = "c1_votes" value = 1 } }
		}
		else_if = {
			limit = { has_character_flag = best_candidate_c2 }
			log = "best candidate c2: [c2.GetBestName]"
			k_papal_state = { change_variable = { which = "c2_votes" value = 1 } }
		}
		else_if = {
			limit = { has_character_flag = best_candidate_c3 }
			log = "best candidate c3: [c3.GetBestName]"
			k_papal_state = { change_variable = { which = "c3_votes" value = 1 } }
		}
		else_if = {
			limit = { has_character_flag = best_candidate_c4 }
			log = "best candidate c4: [c4.GetBestName]"
			k_papal_state = { change_variable = { which = "c4_votes" value = 1 } }
		}
	}
}

province_event = {
	id = prez.9300
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		k_papal_state = {
			holder_scope = {
				character_event = { id = prez.93 }
			}
		}
	}
}

# Pick the winner
character_event = {
	id = prez.93
	desc = DEBUG
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		activate_title = { title = d_americanist status = yes }
	}
	
	option = {
		name = DEBUG
		trigger = {
			k_papal_state = { check_variable = { which = "c1_votes" which = "c2_votes" } }
			k_papal_state = { check_variable = { which = "c1_votes" which = "c3_votes" } }
			k_papal_state = { check_variable = { which = "c1_votes" which = "c4_votes" } }
		}
		event_target:c1 = {
			liege = {
				save_event_target_as = pres_liege
			}
			#d_americanist = { gain_title = PREV }
			#set_defacto_liege = event_target:pres_liege
			save_event_target_as = winner
			narrative_event = { id = prez.94 }
		}
	}
	
	option = {
		name = DEBUG
		trigger = {
			k_papal_state = { check_variable = { which = "c2_votes" which = "c1_votes" } }
			k_papal_state = { check_variable = { which = "c2_votes" which = "c3_votes" } }
			k_papal_state = { check_variable = { which = "c2_votes" which = "c4_votes" } }
		}
		event_target:c2 = {
			liege = {
				save_event_target_as = pres_liege
			}
			#d_americanist = { gain_title = PREV }
			#set_defacto_liege = event_target:pres_liege
			save_event_target_as = winner
			narrative_event = { id = prez.94 }
		}
	}
	
	option = {
		name = DEBUG
		trigger = {
			k_papal_state = { check_variable = { which = "c3_votes" which = "c1_votes" } }
			k_papal_state = { check_variable = { which = "c3_votes" which = "c2_votes" } }
			k_papal_state = { check_variable = { which = "c3_votes" which = "c4_votes" } }
		}
		event_target:c3 = {
			liege = {
				save_event_target_as = pres_liege
			}
			#d_americanist = { gain_title = PREV }
			#set_defacto_liege = event_target:pres_liege
			save_event_target_as = winner
			narrative_event = { id = prez.94 }
		}
	}
	
	option = {
		name = DEBUG
		trigger = {
			k_papal_state = { check_variable = { which = "c4_votes" which = "c1_votes" } }
			k_papal_state = { check_variable = { which = "c4_votes" which = "c2_votes" } }
			k_papal_state = { check_variable = { which = "c4_votes" which = "c3_votes" } }
		}
		event_target:c4 = {
			liege = {
				save_event_target_as = pres_liege
			}
			#d_americanist = { gain_title = PREV }
			#set_defacto_liege = event_target:pres_liege
			save_event_target_as = winner
			narrative_event = { id = prez.94 }
		}
	}
}

# Inform winner and make them President
narrative_event = {
	id = prez.94
	title = prez.94.name
	desc = {
		text = prez.94.desc1
		trigger = {
			NOT = { event_target:c2 = { always = yes } }
			NOT = { event_target:c3 = { always = yes } }
			NOT = { event_target:c4 = { always = yes } }
		}
	}
	desc = {
		text = prez.94.desc2
		trigger = {
			event_target:c2 = { always = yes }
			NOT = { event_target:c3 = { always = yes } }
			NOT = { event_target:c4 = { always = yes } }
		}
	}
	desc = {
		text = prez.94.desc3
		trigger = {
			event_target:c2 = { always = yes }
			event_target:c3 = { always = yes }
			NOT = { event_target:c4 = { always = yes } }
		}
	}
	desc = {
		text = prez.94.desc4
		trigger = {
			event_target:c2 = { always = yes }
			event_target:c3 = { always = yes }
			event_target:c4 = { always = yes }
		}
	}
	picture = GFX_evt_coronation
	border = GFX_event_narrative_frame_religion
	is_triggered_only = yes
	hide_from = yes
	
	option = {
		name = prez.94.optA
		prestige = 500
		remove_trait = on_campaign
		add_trait = president
		set_character_flag = current_president
		clr_character_flag = pres_candidate
		d_americanist = { gain_title = PREV }
		if = {
			limit = { NOT = { dynasty = none } }
			give_nickname = nick_lastname
		}
		hidden_tooltip = {
			set_defacto_liege = event_target:pres_liege
			any_playable_ruler = {
				limit = { religion = americanist }
				character_event = { id = prez.95 }
			}
		}
	}
}

# Inform players of result
character_event = {
	id = prez.95
	desc = {
		text = prez.95.desc1
		trigger = {
			NOT = { event_target:c2 = { always = yes } }
			NOT = { event_target:c3 = { always = yes } }
			NOT = { event_target:c4 = { always = yes } }
		}
	}
	desc = {
		text = prez.95.desc2
		trigger = {
			event_target:c2 = { always = yes }
			NOT = { event_target:c3 = { always = yes } }
			NOT = { event_target:c4 = { always = yes } }
		}
	}
	desc = {
		text = prez.95.desc3
		trigger = {
			event_target:c2 = { always = yes }
			event_target:c3 = { always = yes }
			NOT = { event_target:c4 = { always = yes } }
		}
	}
	desc = {
		text = prez.95.desc4
		trigger = {
			event_target:c2 = { always = yes }
			event_target:c3 = { always = yes }
			event_target:c4 = { always = yes }
		}
	}
	picture = GFX_evt_coronation
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	
	option = {
		name = prez.95.optA
	}
}

province_event = {
	id = prez.9800
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		k_papal_state = {
			holder_scope = {
				character_event = { id = prez.98 }
			}
		}
	}
}

# Cleanup event (all characters)
character_event = {
	id = prez.98
	desc = DEBUG
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		clr_global_flag = force_candidate
		clr_global_flag = pres_election
		clr_global_flag = declare_candidacy
		clr_global_flag = pres_voting
		k_papal_state = {
			set_variable = { which = num_candidates value = 0 }
		}
		any_independent_ruler = {
			any_realm_character = {
				character_event = { id = prez.99 }
			}
		}
	}
	
	option = {
		name = DEBUG
	}
}

# Cleanup event (one character)
character_event = {
	id = prez.99
	desc = DEBUG
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		remove_trait = on_campaign
		clr_character_flag = pres_candidate
		clr_character_flag = vp_candidate
		clr_character_flag = dropped_out
	}
	
	option = {
		name = DEBUG
	}
}

################
# 100-199: Events for the President in power
################

# If the President loses all titles, hold a new election
character_event = {
	id = prez.105
	desc = DEBUG
	is_triggered_only = yes # Triggered from on_new_holder
	hide_window = yes
	
	trigger = {
		trait = president
		has_character_flag = current_president
		NOT = { has_landed_title = d_americanist }
	}
	
	option = {
		name = DEBUG
		character_event = { id = prez.1 }
	}
}

# President has to justify excommunicating someone
character_event = {
	id = prez.106
	desc = EVTDESC_prez_excomm
	picture = GFX_evt_rival_rulers
	is_triggered_only = yes
	religion_group = oldworld
	
	immediate = {
		set_variable = { which = "indolence" value = 0 }
		set_variable = { which = "brutality" value = 0 }
		if = {
			limit = { FROM = { trait = hedonist } }
			change_variable = { which = "indolence" value = 1 }
		}
		if = {
			limit = { FROM = { trait = lustful } }
			change_variable = { which = "indolence" value = 1 }
		}
		if = {
			limit = { FROM = { trait = gluttonous } }
			change_variable = { which = "indolence" value = 1 }
		}
		if = {
			limit = { FROM = { trait = slothful } }
			change_variable = { which = "indolence" value = 1 }
		}
		if = {
			limit = { FROM = { trait = drunkard } }
			change_variable = { which = "indolence" value = 1 }
		}
		if = {
			limit = { FROM = { trait = bad_priest_americanist } }
			change_variable = { which = "indolence" value = 2 }
		}
		
		if = {
			limit = { FROM = { trait = impaler } }
			change_variable = { which = "brutality" value = 1 }
		}
		if = {
			limit = { FROM = { trait = wroth } }
			change_variable = { which = "brutality" value = 1 }
		}
		if = {
			limit = { FROM = { trait = cruel } }
			change_variable = { which = "brutality" value = 1 }
		}
		if = {
			limit = { FROM = { trait = arbitrary } }
			change_variable = { which = "brutality" value = 1 }
		}
		if = {
			limit = { FROM = { trait = lunatic } }
			change_variable = { which = "brutality" value = 1 }
		}
		if = {
			limit = { FROM = { trait = possessed } }
			change_variable = { which = "brutality" value = 1 }
		}
		if = {
			limit = { 
				FROM = { 
					any_vassal = {
						OR = {
							has_opinion_modifier = { who = ROOT modifier = opinion_tyrant }
							has_opinion_modifier = { who = ROOT modifier = opinion_evil_tyrant }
						}
					}
				}
			}
			change_variable = { which = "brutality" value = 1 }
		}
		
		if = {
			limit = { FROM = { NOT = { trait = kinslayer } } }
			FROM = {
				any_dynasty_member = {
					opinion = { modifier = disrespects_dynasty who = ROOT years = 3 }
				}
			}
		}
	}
	
	trigger = {
		OR = {
			religion = americanist
			religion = hamiltonian
			religion = libertarian
			religion = jeffersonian
		}
		controls_religion = yes
	}
	
	option = {
		name = EVTOPT_prez_excom_kinslay
		trigger = {
			FROM = {
				trait = kinslayer
			}
		}
		piety = 10
		ai_chance = { factor = 800 }
	}
	
	option = {
		name = EVTOPT_prez_excom_cruel
		trigger = { check_variable = { which = "brutality" value = 2 } }
		piety = 10
		ai_chance = { factor = 300 }
	}
	
	option = {
		name = EVTOPT_prez_excom_glutton
		trigger = { check_variable = { which = "indolence" value = 2 } }
		piety = 5
		ai_chance = { factor = 100 }
	}
	
	option = {
		name = EVTOPT_prez_excom_cynic
		trigger = {
			FROM = {
				trait = cynical
				NOT = { trait = pilgrim }
			}
		}
		piety = 5
		ai_chance = { factor = 200 }
	}
	option = {
		name = EVTOPT_prez_excom_branded
		trigger = {
			FROM = {
				OR = {
					has_character_modifier = accused_apostate
					has_character_modifier = known_satanist
				}
			}
		}
		piety = 5
		ai_chance = { factor = 800 }
	
	}
	option = {
		name = EVTOPT_prez_excom_intrigue
		trigger = { intrigue = 12 }
		tooltip_info = intrigue
		piety = -10
		ai_chance = { factor = 20 }
	}
	
	option = {
		name = EVTOPT_prez_excom_weak
		piety = -50
		religion_authority = { modifier = unjustified_excommunication }
		ai_chance = { factor = 1 }
	}
}

character_event = {
	id = prez.107
	desc = EVTDESC_prez_excomm_inform
	picture = GFX_evt_rival_rulers
	is_triggered_only = yes

	option = {
		name = OK
		prestige = -25
	}
}

# recently excommunicated character, send event to prez
character_event = {
	id = prez.108
	desc = DEBUG
	hide_window = yes
	
	religion_group = oldworld
	
	trigger = {
		OR = {
			religion = americanist
			religion = hamiltonian
			religion = libertarian
			religion = jeffersonian
		}
		religion_head = {
			NOT = { character = ROOT }
			ROOT = { excommunicated_for = PREV }
		}
		NOT = { has_character_flag = pres_justify_excommunication }
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		set_character_flag = pres_justify_excommunication
		religion_head = { character_event = { id = prez.106 } }
	}
	
	option = {
		name = OK
	}
}


# Americanist owner of Washington asked to give it up

# President is incapacitated, VP or First Lady can try to seize power



################
# 200-299: Election campaigning
################
# Killer of candidate loses public support - candidate dies
character_event = {
	id = prez.200
	desc = prez.200.desc
	picture = GFX_evt_shadow
	is_triggered_only = yes # Triggered by 10 (on_action_events)
	
	option = {
		name = prez.200.optA
		add_character_modifier = { name = murdered_candidate duration = 365 }
		hidden_tooltip = { 
			any_playable_ruler = {
				limit = { religion = americanist }
				character_event = { id = prez.201 }
			}
		}
	}
}

# Notify players
character_event = {
	id = prez.201
	desc = prez.201.desc
	picture = GFX_evt_shadow
	is_triggered_only = yes
	
	notification = yes
	
	option = {
		name = OK
	}
}

# Killer of candidate loses public support - candidate lives
character_event = {
	id = prez.202
	desc = prez.202.desc
	picture = GFX_evt_shadow
	is_triggered_only = yes # Triggered by 11 (on_action_events)
	
	option = {
		name = prez.200.optA
		add_character_modifier = { name = murdered_candidate duration = 365 }
		event_target:target_victim = {
			add_character_modifier = { name = sympathy_vote duration = 365 }
		}
		hidden_tooltip = { 
			any_playable_ruler = {
				limit = { religion = americanist }
				character_event = { id = prez.203 }
			}
		}
	}
}

# Notify players
character_event = {
	id = prez.203
	desc = prez.203.desc
	picture = GFX_evt_shadow
	is_triggered_only = yes
	
	notification = yes
	
	option = {
		name = OK
	}
}

# Apostates can't run
character_event = {
	id = prez.204
	desc = prez.204.desc
	picture = GFX_evt_bishop
	is_triggered_only = yes # Triggered by on_character_convert_religion
	
	trigger = {
		FROM = { religion = americanist }
		trait = on_campaign
	}
	
	option = {
		name = prez.204.optA
		hidden_tooltip = { character_event = { id = prez.8 } }
	}
}

##### OPINION POLLS
# event_target:candidate is the candidate who's commissioning the poll

# Beginning of chain
character_event = {
	id = prez.205
	desc = DEBUG
	is_triggered_only = yes # Triggered by decision hold_opinion_poll
	
	option = {
		name = DEBUG
		clear_event_target = c1
		clear_event_target = c2
		clear_event_target = c3
		clear_event_target = c4
		clear_event_target = c5
		clear_event_target = c6
		clear_event_target = c7
		clear_event_target = c8
		on_campaign = {
			limit = {
				has_character_flag = pres_candidate
			}
			save_event_target_as = c1
			clr_character_flag = 1st_place
			clr_character_flag = 2nd_place
			clr_character_flag = 3rd_place
			clr_character_flag = 4th_place
			log = "c1: [This.GetBestName]"
			character_event = { id = prez.11 days = 2 } # After getting poll, decide whether to drop out
		}
		on_campaign = {
			limit = {
				has_character_flag = pres_candidate
				NOT = { event_target:c1 = { character = PREV } }
			}
			save_event_target_as = c2
			clr_character_flag = 1st_place
			clr_character_flag = 2nd_place
			clr_character_flag = 3rd_place
			clr_character_flag = 4th_place
			log = "c2: [This.GetBestName]"
			character_event = { id = prez.11 days = 2 } # After getting poll, decide whether to drop out
		}
		on_campaign = {
			limit = {
				has_character_flag = pres_candidate
				NOT = { event_target:c1 = { character = PREV } }
				NOT = { event_target:c2 = { character = PREV } }
			}
			save_event_target_as = c3
			clr_character_flag = 1st_place
			clr_character_flag = 2nd_place
			clr_character_flag = 3rd_place
			clr_character_flag = 4th_place
			log = "c3: [This.GetBestName]"
			character_event = { id = prez.11 days = 2 } # After getting poll, decide whether to drop out
		}
		on_campaign = {
			limit = {
				has_character_flag = pres_candidate
				NOT = { event_target:c1 = { character = PREV } }
				NOT = { event_target:c2 = { character = PREV } }
				NOT = { event_target:c3 = { character = PREV } }
			}
			save_event_target_as = c4
			clr_character_flag = 1st_place
			clr_character_flag = 2nd_place
			clr_character_flag = 3rd_place
			clr_character_flag = 4th_place
			log = "c4: [This.GetBestName]"
			character_event = { id = prez.11 days = 2 } # After getting poll, decide whether to drop out
		}
		on_campaign = {
			limit = {
				has_character_flag = pres_candidate
				NOT = { event_target:c1 = { character = PREV } }
				NOT = { event_target:c2 = { character = PREV } }
				NOT = { event_target:c3 = { character = PREV } }
				NOT = { event_target:c4 = { character = PREV } }
			}
			save_event_target_as = c5
			clr_character_flag = 1st_place
			clr_character_flag = 2nd_place
			clr_character_flag = 3rd_place
			clr_character_flag = 4th_place
			log = "c5: [This.GetBestName]"
			character_event = { id = prez.11 days = 2 } # After getting poll, decide whether to drop out
		}
		on_campaign = {
			limit = {
				has_character_flag = pres_candidate
				NOT = { event_target:c1 = { character = PREV } }
				NOT = { event_target:c2 = { character = PREV } }
				NOT = { event_target:c3 = { character = PREV } }
				NOT = { event_target:c4 = { character = PREV } }
				NOT = { event_target:c5 = { character = PREV } }
			}
			save_event_target_as = c6
			clr_character_flag = 1st_place
			clr_character_flag = 2nd_place
			clr_character_flag = 3rd_place
			clr_character_flag = 4th_place
			log = "c6: [This.GetBestName]"
			character_event = { id = prez.11 days = 2 } # After getting poll, decide whether to drop out
		}
		on_campaign = {
			limit = {
				has_character_flag = pres_candidate
				NOT = { event_target:c1 = { character = PREV } }
				NOT = { event_target:c2 = { character = PREV } }
				NOT = { event_target:c3 = { character = PREV } }
				NOT = { event_target:c4 = { character = PREV } }
				NOT = { event_target:c5 = { character = PREV } }
				NOT = { event_target:c6 = { character = PREV } }
			}
			save_event_target_as = c7
			clr_character_flag = 1st_place
			clr_character_flag = 2nd_place
			clr_character_flag = 3rd_place
			clr_character_flag = 4th_place
			log = "c7: [This.GetBestName]"
			character_event = { id = prez.11 days = 2 } # After getting poll, decide whether to drop out
		}
		on_campaign = {
			limit = {
				has_character_flag = pres_candidate
				NOT = { event_target:c1 = { character = PREV } }
				NOT = { event_target:c2 = { character = PREV } }
				NOT = { event_target:c3 = { character = PREV } }
				NOT = { event_target:c4 = { character = PREV } }
				NOT = { event_target:c5 = { character = PREV } }
				NOT = { event_target:c6 = { character = PREV } }
				NOT = { event_target:c7 = { character = PREV } }
			}
			save_event_target_as = c8
			clr_character_flag = 1st_place
			clr_character_flag = 2nd_place
			clr_character_flag = 3rd_place
			clr_character_flag = 4th_place
			log = "c8: [This.GetBestName]"
			character_event = { id = prez.11 days = 2 } # After getting poll, decide whether to drop out
		}
		k_papal_state = {
			set_variable = { which = "c1_votes" value = 0 }
			set_variable = { which = "c2_votes" value = 0 }
			set_variable = { which = "c3_votes" value = 0 }
			set_variable = { which = "c4_votes" value = 0 }
			set_variable = { which = "c5_votes" value = 0 }
			set_variable = { which = "c6_votes" value = 0 }
			set_variable = { which = "c7_votes" value = 0 }
			set_variable = { which = "c8_votes" value = 0 }

			set_variable = { which = "1st_place" value = 0 }
			set_variable = { which = "2nd_place" value = 0 }
			set_variable = { which = "3rd_place" value = 0 }
			set_variable = { which = "4th_place" value = 0 }
			set_variable = { which = "1st_place_index" value = 0 }
			set_variable = { which = "2nd_place_index" value = 0 }
			set_variable = { which = "3rd_place_index" value = 0 }
			set_variable = { which = "4th_place_index" value = 0 }
		}
		1050 = { province_event = { id = prez.2080 days = 1 } }
		
		any_independent_ruler = {
			any_realm_character = {
				limit = {
					religion = americanist
					is_adult = yes
					ai = yes
				}
				random = {
					chance = 33 #it's an opinion poll, so it will be imperfect
					character_event = { id = prez.207 }
				}
			}
		}
	}
}

# Ask who they're going to vote for
character_event = {
	id = prez.207
	desc = DEBUG
	is_triggered_only = yes

	option = {
		log = "----------------------------"
		log = "Evaluating poll for [Root.GetBestName]"
		set_variable = { which = newCandidate value = 0 }
		set_variable = { which = bestCandidate value = 0 }
		clr_character_flag = evaluated_candidate_c1
		clr_character_flag = evaluated_candidate_c2
		clr_character_flag = evaluated_candidate_c3
		clr_character_flag = evaluated_candidate_c4
		clr_character_flag = evaluated_candidate_c5
		clr_character_flag = evaluated_candidate_c6
		clr_character_flag = evaluated_candidate_c7
		clr_character_flag = evaluated_candidate_c8
		clr_character_flag = current_candidate_c1
		clr_character_flag = current_candidate_c2
		clr_character_flag = current_candidate_c3
		clr_character_flag = current_candidate_c4
		clr_character_flag = current_candidate_c5
		clr_character_flag = current_candidate_c6
		clr_character_flag = current_candidate_c7
		clr_character_flag = current_candidate_c8
		clr_character_flag = best_candidate_c1
		clr_character_flag = best_candidate_c2
		clr_character_flag = best_candidate_c3
		clr_character_flag = best_candidate_c4
		clr_character_flag = best_candidate_c5
		clr_character_flag = best_candidate_c6
		clr_character_flag = best_candidate_c7
		clr_character_flag = best_candidate_c8
		if = {
			limit = { NOT = { event_target:c1 = { always = yes } } }
			set_character_flag = evaluated_candidate_c1
		}
		if = {
			limit = { NOT = { event_target:c2 = { always = yes } } }
			set_character_flag = evaluated_candidate_c2
		}
		if = {
			limit = { NOT = { event_target:c3 = { always = yes } } }
			set_character_flag = evaluated_candidate_c3
		}
		if = {
			limit = { NOT = { event_target:c4 = { always = yes } } }
			set_character_flag = evaluated_candidate_c4
		}
		if = {
			limit = { NOT = { event_target:c5 = { always = yes } } }
			set_character_flag = evaluated_candidate_c5
		}
		if = {
			limit = { NOT = { event_target:c6 = { always = yes } } }
			set_character_flag = evaluated_candidate_c6
		}
		if = {
			limit = { NOT = { event_target:c7 = { always = yes } } }
			set_character_flag = evaluated_candidate_c7
		}
		if = {
			limit = { NOT = { event_target:c8 = { always = yes } } }
			set_character_flag = evaluated_candidate_c8
		}
		if = {
			limit = { NOT = { has_character_flag = evaluated_candidate_c1 } }
			event_target:c1 = { save_event_target_as = new_candidate }
			set_character_flag = current_candidate_c1
			log = "Current candidate c1: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { NOT = { has_character_flag = evaluated_candidate_c2 } }
			event_target:c2 = { save_event_target_as = new_candidate }
			set_character_flag = current_candidate_c2
			log = "Current candidate c2: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { NOT = { has_character_flag = evaluated_candidate_c3 } }
			event_target:c3 = { save_event_target_as = new_candidate }
			set_character_flag = current_candidate_c3
			log = "Current candidate c3: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { NOT = { has_character_flag = evaluated_candidate_c4 } }
			event_target:c4 = { save_event_target_as = new_candidate }
			set_character_flag = current_candidate_c4
			log = "Current candidate c4: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { NOT = { has_character_flag = evaluated_candidate_c5 } }
			event_target:c5 = { save_event_target_as = new_candidate }
			set_character_flag = current_candidate_c5
			log = "Current candidate c5: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { NOT = { has_character_flag = evaluated_candidate_c6 } }
			event_target:c6 = { save_event_target_as = new_candidate }
			set_character_flag = current_candidate_c6
			log = "Current candidate c6: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { NOT = { has_character_flag = evaluated_candidate_c7 } }
			event_target:c7 = { save_event_target_as = new_candidate }
			set_character_flag = current_candidate_c7
			log = "Current candidate c7: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { NOT = { has_character_flag = evaluated_candidate_c8 } }
			event_target:c8 = { save_event_target_as = new_candidate }
			set_character_flag = current_candidate_c8
			log = "Current candidate c8: [new_candidate.GetBestName]"
		}
		calculate_candidate_score = yes
		log = "[new_candidate.GetBestName]: [Root.newCandidate.GetValue] best candidate: [Root.bestCandidate.GetValue]"
		set_variable = { which = bestCandidate which = newCandidate }
		if = {
			limit = { has_character_flag = current_candidate_c1 }
			set_character_flag = evaluated_candidate_c1
			set_character_flag = best_candidate_c1
			log = "new best candidate c1: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { has_character_flag = current_candidate_c2 }
			set_character_flag = evaluated_candidate_c2
			set_character_flag = best_candidate_c2
			log = "new best candidate c2: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { has_character_flag = current_candidate_c3 }
			set_character_flag = evaluated_candidate_c3
			set_character_flag = best_candidate_c3
			log = "new best candidate c3: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { has_character_flag = current_candidate_c4 }
			set_character_flag = evaluated_candidate_c4
			set_character_flag = best_candidate_c4
			log = "new best candidate c4: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { has_character_flag = current_candidate_c5 }
			set_character_flag = evaluated_candidate_c5
			set_character_flag = best_candidate_c5
			log = "new best candidate c5: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { has_character_flag = current_candidate_c6 }
			set_character_flag = evaluated_candidate_c6
			set_character_flag = best_candidate_c6
			log = "new best candidate c6: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { has_character_flag = current_candidate_c7 }
			set_character_flag = evaluated_candidate_c7
			set_character_flag = best_candidate_c7
			log = "new best candidate c7: [new_candidate.GetBestName]"
		}
		else_if = {
			limit = { has_character_flag = current_candidate_c8 }
			set_character_flag = evaluated_candidate_c8
			set_character_flag = best_candidate_c8
			log = "new best candidate c8: [new_candidate.GetBestName]"
		}
		evaluate_candidate = yes
		evaluate_candidate = yes
		evaluate_candidate = yes
		evaluate_candidate = yes
		evaluate_candidate = yes
		evaluate_candidate = yes
		evaluate_candidate = yes
		if = {
			limit = { has_character_flag = best_candidate_c1 }
			log = "best candidate c1: [c1.GetBestName]"
			k_papal_state = { 
				if = {
					limit = {
						check_variable = { which ="c1_votes" which = "1st_place" }
					}
					change_variable = { which = "c1_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "1st_place_index" value = 1 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "2nd_place" }
						set_variable = { which = "3rd_place_index" which = "2nd_place_index" }
						set_variable = { which = "2nd_place" which = "1st_place" }
						set_variable = { which = "2nd_place_index" which = "1st_place_index" }
						set_variable = { which = "1st_place" which = "c1_votes" }
						set_variable = { which = "1st_place_index" value = 1 }
					}
					else = {
						set_variable = { which = "1st_place" which = "c1_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c1_votes" which = "2nd_place" }
					}
					change_variable = { which = "c1_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "2nd_place_index" value = 1 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "2nd_place" }
						set_variable = { which = "3rd_place_index" which = "2nd_place_index" }
						set_variable = { which = "2nd_place" which = "c1_votes" }
						set_variable = { which = "2nd_place_index" value = 1 }
					}
					else = {
						set_variable = { which = "2nd_place" which = "c1_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c1_votes" which = "3rd_place" }
					}
					change_variable = { which = "c1_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "3rd_place_index" value = 1 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "c1_votes" }
						set_variable = { which = "3rd_place_index" value = 1 }
					}
					else = {
						set_variable = { which = "3rd_place" which = "c1_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c1_votes" which = "4th_place" }
					}
					change_variable = { which = "c1_votes" value = 3 }
					set_variable = { which = "4th_place" which = "c1_votes" }
					set_variable = { which = "4th_place_index" value = 1 }
				}
				else = {
					change_variable = { which = "c1_votes" value = 3 }
				}
			}
		}
		else_if = {
			limit = { has_character_flag = best_candidate_c2 }
			log = "best candidate c2: [c2.GetBestName]"
			k_papal_state = { 
				if = {
					limit = {
						check_variable = { which ="c2_votes" which = "1st_place" }
					}
					change_variable = { which = "c2_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "1st_place_index" value = 2 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "2nd_place" }
						set_variable = { which = "3rd_place_index" which = "2nd_place_index" }
						set_variable = { which = "2nd_place" which = "1st_place" }
						set_variable = { which = "2nd_place_index" which = "1st_place_index" }
						set_variable = { which = "1st_place" which = "c2_votes" }
						set_variable = { which = "1st_place_index" value = 2 }
					}
					else = {
						set_variable = { which = "1st_place" which = "c2_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c2_votes" which = "2nd_place" }
					}
					change_variable = { which = "c2_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "2nd_place_index" value = 2 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "2nd_place" }
						set_variable = { which = "3rd_place_index" which = "2nd_place_index" }
						set_variable = { which = "2nd_place" which = "c2_votes" }
						set_variable = { which = "2nd_place_index" value = 2 }
					}
					else = {
						set_variable = { which = "2nd_place" which = "c2_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c2_votes" which = "3rd_place" }
					}
					change_variable = { which = "c2_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "3rd_place_index" value = 2 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "c2_votes" }
						set_variable = { which = "3rd_place_index" value = 2 }
					}
					else = {
						set_variable = { which = "3rd_place" which = "c2_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c2_votes" which = "4th_place" }
					}
					change_variable = { which = "c2_votes" value = 3 }
					set_variable = { which = "4th_place" which = "c2_votes" }
					set_variable = { which = "4th_place_index" value = 2 }
				}
				else = {
					change_variable = { which = "c2_votes" value = 3 }
				}
			}
		}
		else_if = {
			limit = { has_character_flag = best_candidate_c3 }
			log = "best candidate c3: [c3.GetBestName]"
			k_papal_state = { 
				if = {
					limit = {
						check_variable = { which ="c3_votes" which = "1st_place" }
					}
					change_variable = { which = "c3_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "1st_place_index" value = 3 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "2nd_place" }
						set_variable = { which = "3rd_place_index" which = "2nd_place_index" }
						set_variable = { which = "2nd_place" which = "1st_place" }
						set_variable = { which = "2nd_place_index" which = "1st_place_index" }
						set_variable = { which = "1st_place" which = "c3_votes" }
						set_variable = { which = "1st_place_index" value = 3 }
					}
					else = {
						set_variable = { which = "1st_place" which = "c3_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c3_votes" which = "2nd_place" }
					}
					change_variable = { which = "c3_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "2nd_place_index" value = 3 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "2nd_place" }
						set_variable = { which = "3rd_place_index" which = "2nd_place_index" }
						set_variable = { which = "2nd_place" which = "c3_votes" }
						set_variable = { which = "2nd_place_index" value = 3 }
					}
					else = {
						set_variable = { which = "2nd_place" which = "c3_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c3_votes" which = "3rd_place" }
					}
					change_variable = { which = "c3_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "3rd_place_index" value = 3 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "c3_votes" }
						set_variable = { which = "3rd_place_index" value = 3 }
					}
					else = {
						set_variable = { which = "3rd_place" which = "c3_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c3_votes" which = "4th_place" }
					}
					change_variable = { which = "c3_votes" value = 3 }
					set_variable = { which = "4th_place" which = "c3_votes" }
					set_variable = { which = "4th_place_index" value = 3 }
				}
				else = {
					change_variable = { which = "c3_votes" value = 3 }
				}
			}
		}
		else_if = {
			limit = { has_character_flag = best_candidate_c4 }
			log = "best candidate c4: [c4.GetBestName]"
			k_papal_state = { 
				if = {
					limit = {
						check_variable = { which ="c4_votes" which = "1st_place" }
					}
					change_variable = { which = "c4_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "1st_place_index" value = 4 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "2nd_place" }
						set_variable = { which = "3rd_place_index" which = "2nd_place_index" }
						set_variable = { which = "2nd_place" which = "1st_place" }
						set_variable = { which = "2nd_place_index" which = "1st_place_index" }
						set_variable = { which = "1st_place" which = "c4_votes" }
						set_variable = { which = "1st_place_index" value = 4 }
					}
					else = {
						set_variable = { which = "1st_place" which = "c4_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c4_votes" which = "2nd_place" }
					}
					change_variable = { which = "c4_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "2nd_place_index" value = 4 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "2nd_place" }
						set_variable = { which = "3rd_place_index" which = "2nd_place_index" }
						set_variable = { which = "2nd_place" which = "c4_votes" }
						set_variable = { which = "2nd_place_index" value = 4 }
					}
					else = {
						set_variable = { which = "2nd_place" which = "c4_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c4_votes" which = "3rd_place" }
					}
					change_variable = { which = "c4_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "3rd_place_index" value = 4 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "c4_votes" }
						set_variable = { which = "3rd_place_index" value = 4 }
					}
					else = {
						set_variable = { which = "3rd_place" which = "c4_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c4_votes" which = "4th_place" }
					}
					change_variable = { which = "c4_votes" value = 3 }
					set_variable = { which = "4th_place" which = "c4_votes" }
					set_variable = { which = "4th_place_index" value = 4 }
				}
				else = {
					change_variable = { which = "c4_votes" value = 3 }
				}
			}
		}
		else_if = {
			limit = { has_character_flag = best_candidate_c5 }
			log = "best candidate c5: [c5.GetBestName]"
			k_papal_state = { 
				if = {
					limit = {
						check_variable = { which ="c5_votes" which = "1st_place" }
					}
					change_variable = { which = "c5_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "1st_place_index" value = 5 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "2nd_place" }
						set_variable = { which = "3rd_place_index" which = "2nd_place_index" }
						set_variable = { which = "2nd_place" which = "1st_place" }
						set_variable = { which = "2nd_place_index" which = "1st_place_index" }
						set_variable = { which = "1st_place" which = "c5_votes" }
						set_variable = { which = "1st_place_index" value = 5 }
					}
					else = {
						set_variable = { which = "1st_place" which = "c5_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c5_votes" which = "2nd_place" }
					}
					change_variable = { which = "c5_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "2nd_place_index" value = 5 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "2nd_place" }
						set_variable = { which = "3rd_place_index" which = "2nd_place_index" }
						set_variable = { which = "2nd_place" which = "c5_votes" }
						set_variable = { which = "2nd_place_index" value = 5 }
					}
					else = {
						set_variable = { which = "2nd_place" which = "c5_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c5_votes" which = "3rd_place" }
					}
					change_variable = { which = "c5_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "3rd_place_index" value = 5 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "c5_votes" }
						set_variable = { which = "3rd_place_index" value = 5 }
					}
					else = {
						set_variable = { which = "3rd_place" which = "c5_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c5_votes" which = "4th_place" }
					}
					change_variable = { which = "c5_votes" value = 3 }
					set_variable = { which = "4th_place" which = "c5_votes" }
					set_variable = { which = "4th_place_index" value = 5 }
				}
				else = {
					change_variable = { which = "c5_votes" value = 3 }
				}
			}
		}
		else_if = {
			limit = { has_character_flag = best_candidate_c6 }
			log = "best candidate c6: [c6.GetBestName]"
			k_papal_state = { 
				if = {
					limit = {
						check_variable = { which ="c6_votes" which = "1st_place" }
					}
					change_variable = { which = "c6_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "1st_place_index" value = 6 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "2nd_place" }
						set_variable = { which = "3rd_place_index" which = "2nd_place_index" }
						set_variable = { which = "2nd_place" which = "1st_place" }
						set_variable = { which = "2nd_place_index" which = "1st_place_index" }
						set_variable = { which = "1st_place" which = "c6_votes" }
						set_variable = { which = "1st_place_index" value = 6 }
					}
					else = {
						set_variable = { which = "1st_place" which = "c6_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c6_votes" which = "2nd_place" }
					}
					change_variable = { which = "c6_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "2nd_place_index" value = 6 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "2nd_place" }
						set_variable = { which = "3rd_place_index" which = "2nd_place_index" }
						set_variable = { which = "2nd_place" which = "c6_votes" }
						set_variable = { which = "2nd_place_index" value = 6 }
					}
					else = {
						set_variable = { which = "2nd_place" which = "c6_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c6_votes" which = "3rd_place" }
					}
					change_variable = { which = "c6_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "3rd_place_index" value = 6 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "c6_votes" }
						set_variable = { which = "3rd_place_index" value = 6 }
					}
					else = {
						set_variable = { which = "3rd_place" which = "c6_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c6_votes" which = "4th_place" }
					}
					change_variable = { which = "c6_votes" value = 3 }
					set_variable = { which = "4th_place" which = "c6_votes" }
					set_variable = { which = "4th_place_index" value = 6 }
				}
				else = {
					change_variable = { which = "c6_votes" value = 3 }
				}
			}
		}
		else_if = {
			limit = { has_character_flag = best_candidate_c7 }
			log = "best candidate c7: [c7.GetBestName]"
			k_papal_state = { 
				if = {
					limit = {
						check_variable = { which ="c7_votes" which = "1st_place" }
					}
					change_variable = { which = "c7_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "1st_place_index" value = 7 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "2nd_place" }
						set_variable = { which = "3rd_place_index" which = "2nd_place_index" }
						set_variable = { which = "2nd_place" which = "1st_place" }
						set_variable = { which = "2nd_place_index" which = "1st_place_index" }
						set_variable = { which = "1st_place" which = "c7_votes" }
						set_variable = { which = "1st_place_index" value = 7 }
					}
					else = {
						set_variable = { which = "1st_place" which = "c7_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c7_votes" which = "2nd_place" }
					}
					change_variable = { which = "c7_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "2nd_place_index" value = 7 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "2nd_place" }
						set_variable = { which = "3rd_place_index" which = "2nd_place_index" }
						set_variable = { which = "2nd_place" which = "c7_votes" }
						set_variable = { which = "2nd_place_index" value = 7 }
					}
					else = {
						set_variable = { which = "2nd_place" which = "c7_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c7_votes" which = "3rd_place" }
					}
					change_variable = { which = "c7_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "3rd_place_index" value = 7 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "c7_votes" }
						set_variable = { which = "3rd_place_index" value = 7 }
					}
					else = {
						set_variable = { which = "3rd_place" which = "c7_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c7_votes" which = "4th_place" }
					}
					change_variable = { which = "c7_votes" value = 3 }
					set_variable = { which = "4th_place" which = "c7_votes" }
					set_variable = { which = "4th_place_index" value = 7 }
				}
				else = {
					change_variable = { which = "c7_votes" value = 3 }
				}
			}
		}
		else_if = {
			limit = { has_character_flag = best_candidate_c8 }
			log = "best candidate c8: [c8.GetBestName]"
			k_papal_state = { 
				if = {
					limit = {
						check_variable = { which ="c8_votes" which = "1st_place" }
					}
					change_variable = { which = "c8_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "1st_place_index" value = 8 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "2nd_place" }
						set_variable = { which = "3rd_place_index" which = "2nd_place_index" }
						set_variable = { which = "2nd_place" which = "1st_place" }
						set_variable = { which = "2nd_place_index" which = "1st_place_index" }
						set_variable = { which = "1st_place" which = "c8_votes" }
						set_variable = { which = "1st_place_index" value = 8 }
					}
					else = {
						set_variable = { which = "1st_place" which = "c8_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c8_votes" which = "2nd_place" }
					}
					change_variable = { which = "c8_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "2nd_place_index" value = 8 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "2nd_place" }
						set_variable = { which = "3rd_place_index" which = "2nd_place_index" }
						set_variable = { which = "2nd_place" which = "c8_votes" }
						set_variable = { which = "2nd_place_index" value = 8 }
					}
					else = {
						set_variable = { which = "2nd_place" which = "c8_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c8_votes" which = "3rd_place" }
					}
					change_variable = { which = "c8_votes" value = 3 }
					if = {
						limit = { NOT = { is_variable_equal = { which = "3rd_place_index" value = 8 } } }
						set_variable = { which = "4th_place" which = "3rd_place" }
						set_variable = { which = "4th_place_index" which = "3rd_place_index" }
						set_variable = { which = "3rd_place" which = "c8_votes" }
						set_variable = { which = "3rd_place_index" value = 8 }
					}
					else = {
						set_variable = { which = "3rd_place" which = "c8_votes" }
					}
				}
				else_if = {
					limit = {
						check_variable = { which ="c8_votes" which = "4th_place" }
					}
					change_variable = { which = "c8_votes" value = 3 }
					set_variable = { which = "4th_place" which = "c8_votes" }
					set_variable = { which = "4th_place_index" value = 8 }
				}
				else = {
					change_variable = { which = "c8_votes" value = 3 }
				}
			}
		}
	}
}

province_event = {
	id = prez.2080
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		k_papal_state = {
			holder_scope = {
				character_event = { id = prez.208 }
			}
		}
	}
}

# Report results, and set flags for AI
character_event = {
	id = prez.208
	desc = prez.208.desc
	picture = GFX_evt_recieve_letter
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		log = "----------------------------"
		log = "Determine place, [Root.GetBestName]"
		k_papal_state = {
			log = "c1: [This.c1_votes.GetValue]"
			log = "c2: [This.c2_votes.GetValue]"
			log = "c3: [This.c3_votes.GetValue]"
			log = "c4: [This.c4_votes.GetValue]"
			log = "c5: [This.c5_votes.GetValue]"
			log = "c6: [This.c6_votes.GetValue]"
			log = "c7: [This.c7_votes.GetValue]"
			log = "c8: [This.c8_votes.GetValue]"

			log = "1st_place: [This.1st_place.GetValue]"
			log = "2nd_place: [This.2nd_place.GetValue]"
			log = "3rd_place: [This.3rd_place.GetValue]"
			log = "4th_place: [This.4th_place.GetValue]"

			log = "1st_place_index: [This.1st_place_index.GetValue]"
			log = "2nd_place_index: [This.2nd_place_index.GetValue]"
			log = "3rd_place_index: [This.3rd_place_index.GetValue]"
			log = "4th_place_index: [This.4th_place_index.GetValue]"
		}
		k_papal_state = {
			if = {
				limit = {
					is_variable_equal = { which = "1st_place_index" value = 1 }
				}
				event_target:c1 = { set_character_flag = 1st_place log = "1st_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "1st_place_index" value = 2 }
				}
				event_target:c2 = { set_character_flag = 1st_place log = "1st_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "1st_place_index" value = 3 }
				}
				event_target:c3 = { set_character_flag = 1st_place log = "1st_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "1st_place_index" value = 4 }
				}
				event_target:c4 = { set_character_flag = 1st_place log = "1st_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "1st_place_index" value = 5 }
				}
				event_target:c5 = { set_character_flag = 1st_place log = "1st_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "1st_place_index" value = 6 }
				}
				event_target:c6 = { set_character_flag = 1st_place log = "1st_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "1st_place_index" value = 7 }
				}
				event_target:c7 = { set_character_flag = 1st_place log = "1st_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "1st_place_index" value = 8 }
				}
				event_target:c8 = { set_character_flag = 1st_place log = "1st_place: [This.GetBestName]" }
			}

			if = {
				limit = {
					is_variable_equal = { which = "2nd_place_index" value = 1 }
				}
				event_target:c1 = { set_character_flag = 2nd_place log = "2nd_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "2nd_place_index" value = 2 }
				}
				event_target:c2 = { set_character_flag = 2nd_place log = "2nd_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "2nd_place_index" value = 3 }
				}
				event_target:c3 = { set_character_flag = 2nd_place log = "2nd_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "2nd_place_index" value = 4 }
				}
				event_target:c4 = { set_character_flag = 2nd_place log = "2nd_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "2nd_place_index" value = 5 }
				}
				event_target:c5 = { set_character_flag = 2nd_place log = "2nd_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "2nd_place_index" value = 6 }
				}
				event_target:c6 = { set_character_flag = 2nd_place log = "2nd_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "2nd_place_index" value = 7 }
				}
				event_target:c7 = { set_character_flag = 2nd_place log = "2nd_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "2nd_place_index" value = 8 }
				}
				event_target:c8 = { set_character_flag = 2nd_place log = "2nd_place: [This.GetBestName]" }
			}

			if = {
				limit = {
					is_variable_equal = { which = "3rd_place_index" value = 1 }
				}
				event_target:c1 = { set_character_flag = 3rd_place log = "3rd_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "3rd_place_index" value = 2 }
				}
				event_target:c2 = { set_character_flag = 3rd_place log = "3rd_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "3rd_place_index" value = 3 }
				}
				event_target:c3 = { set_character_flag = 3rd_place log = "3rd_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "3rd_place_index" value = 4 }
				}
				event_target:c4 = { set_character_flag = 3rd_place log = "3rd_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "3rd_place_index" value = 5 }
				}
				event_target:c5 = { set_character_flag = 3rd_place log = "3rd_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "3rd_place_index" value = 6 }
				}
				event_target:c6 = { set_character_flag = 3rd_place log = "3rd_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "3rd_place_index" value = 7 }
				}
				event_target:c7 = { set_character_flag = 3rd_place log = "3rd_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "3rd_place_index" value = 8 }
				}
				event_target:c8 = { set_character_flag = 3rd_place log = "3rd_place: [This.GetBestName]" }
			}

			if = {
				limit = {
					is_variable_equal = { which = "4th_place_index" value = 1 }
				}
				event_target:c1 = { set_character_flag = 4th_place log = "4th_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "4th_place_index" value = 2 }
				}
				event_target:c2 = { set_character_flag = 4th_place log = "4th_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "4th_place_index" value = 3 }
				}
				event_target:c3 = { set_character_flag = 4th_place log = "4th_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "4th_place_index" value = 4 }
				}
				event_target:c4 = { set_character_flag = 4th_place log = "4th_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "4th_place_index" value = 5 }
				}
				event_target:c5 = { set_character_flag = 4th_place log = "4th_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "4th_place_index" value = 6 }
				}
				event_target:c6 = { set_character_flag = 4th_place log = "4th_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "4th_place_index" value = 7 }
				}
				event_target:c7 = { set_character_flag = 4th_place log = "4th_place: [This.GetBestName]" }
			}
			else_if = {
				limit = {
					is_variable_equal = { which = "4th_place_index" value = 8 }
				}
				event_target:c8 = { set_character_flag = 4th_place log = "4th_place: [This.GetBestName]" }
			}
		}
	}
}

#### ATTACK HERALDS
# FROM is the target, FROMFROM is the attacker

# Attack fails, caught
character_event = {
	id = prez.210
	desc = {
		text = attack_herald_cynical_fail_caught
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = cynical
					trait = mystic
					NOT = { piety = 0 }
				}
			}
		}
	}
	desc = {
		text = attack_herald_craven_fail_caught
		trigger = {
			event_target:ctarget = {
				trait = craven
			}
		}
	}
	desc = {
		text = attack_herald_lunatic_fail_caught
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = lunatic
					trait = possessed
					trait = depressed
					trait = stressed
				}
			}
		}
	}
	desc = {
		text = attack_herald_lustful_fail_caught
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = lustful
					trait = seducer
					trait = seductress
					trait = hedonist
					trait = homosexual
					any_child = {
						OR = {
							trait = bastard
							trait = legit_bastard
						}
					}
				}
			}
		}
	}
	desc = {
		text = attack_herald_deceitful_fail_caught
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = paranoid
					trait = deceitful
					trait = schemer
				}
			}
		}
	}
	desc = {
		text = attack_herald_arbitrary_fail_caught
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = arbitrary
					trait = cruel
					trait = impaler
				}
			}
		}
	}
	desc = {
		text = attack_herald_trusting_fail_caught
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = trusting
					trait = kind
				}
			}
		}
	}
	desc = {
		text = attack_herald_cursed_fail_caught
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = dwarf
					trait = ugly
					trait = harelip
					trait = hunchback
					trait = clubfooted
					trait = lisp
					trait = stutter
					trait = slow
					trait = imbecile
					trait = inbred
					trait = weak
				}
			}
		}
	}
	desc = {
		text = attack_herald_generic_fail_caught
	}
	is_triggered_only = yes
	notification = yes
	show_from_from = yes

	immediate = {
		event_target:cattacker = { reverse_opinion = { who = ROOT modifier = negative_campaign years = 2 } }
		event_target:cattacker = {
			event_target:ctarget = {
				opinion = { who = PREV modifier = attacked_me years = 2 }
			}
		}
	}
	
	option = {
		name = OK
	}
}

# Attack fails, not caught
character_event = {
	id = prez.211
	desc = {
		text = attack_herald_cynical_fail
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = cynical
					trait = mystic
					NOT = { piety = 0 }
				}
			}
		}
	}
	desc = {
		text = attack_herald_craven_fail
		trigger = {
			event_target:ctarget = {
				trait = craven
			}
		}
	}
	desc = {
		text = attack_herald_lunatic_fail
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = lunatic
					trait = possessed
					trait = depressed
					trait = stressed
				}
			}
		}
	}
	desc = {
		text = attack_herald_lustful_fail
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = lustful
					trait = seducer
					trait = seductress
					trait = hedonist
					trait = homosexual
					any_child = {
						OR = {
							trait = bastard
							trait = legit_bastard
						}
					}
				}
			}
		}
	}
	desc = {
		text = attack_herald_deceitful_fail
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = paranoid
					trait = deceitful
					trait = schemer
				}
			}
		}
	}
	desc = {
		text = attack_herald_arbitrary_fail
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = arbitrary
					trait = cruel
					trait = impaler
				}
			}
		}
	}
	desc = {
		text = attack_herald_trusting_fail
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = trusting
					trait = kind
				}
			}
		}
	}
	desc = {
		text = attack_herald_cursed_fail
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = dwarf
					trait = ugly
					trait = harelip
					trait = hunchback
					trait = clubfooted
					trait = lisp
					trait = stutter
					trait = slow
					trait = imbecile
					trait = inbred
					trait = weak
				}
			}
		}
	}
	desc = {
		text = attack_herald_generic_fail
	}
	is_triggered_only = yes
	notification = yes
	
	option = {
		name = OK
	}
}

# Attack succeeds, caught
character_event = {
	id = prez.212
	desc = {
		text = attack_herald_cynical_succ_caught
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = cynical
					trait = mystic
					NOT = { piety = 0 }
				}
			}
		}
	}
	desc = {
		text = attack_herald_craven_succ_caught
		trigger = {
			event_target:ctarget = {
				trait = craven
			}
		}
	}
	desc = {
		text = attack_herald_lunatic_succ_caught
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = lunatic
					trait = possessed
					trait = depressed
					trait = stressed
				}
			}
		}
	}
	desc = {
		text = attack_herald_lustful_succ_caught
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = lustful
					trait = seducer
					trait = seductress
					trait = hedonist
					trait = homosexual
					any_child = {
						OR = {
							trait = bastard
							trait = legit_bastard
						}
					}
				}
			}
		}
	}
	desc = {
		text = attack_herald_deceitful_succ_caught
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = paranoid
					trait = deceitful
					trait = schemer
				}
			}
		}
	}
	desc = {
		text = attack_herald_arbitrary_succ_caught
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = arbitrary
					trait = cruel
					trait = impaler
				}
			}
		}
	}
	desc = {
		text = attack_herald_trusting_succ_caught
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = trusting
					trait = kind
				}
			}
		}
	}
	desc = {
		text = attack_herald_cursed_succ_caught
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = dwarf
					trait = ugly
					trait = harelip
					trait = hunchback
					trait = clubfooted
					trait = lisp
					trait = stutter
					trait = slow
					trait = imbecile
					trait = inbred
					trait = weak
				}
			}
		}
	}
	desc = {
		text = attack_herald_generic_succ_caught
	}
	is_triggered_only = yes
	notification = yes
	show_from_from = yes

	immediate = {
		event_target:cattacker = { reverse_opinion = { who = ROOT modifier = negative_campaign years = 2 } }
		event_target:ctarget = { reverse_opinion = { who = ROOT modifier = attack_heralds years = 2 } }
		event_target:cattacker = {
			event_target:ctarget = {
				opinion = { who = PREV modifier = attacked_me years = 2 }
			}
		}
	}
	
	option = {
		name = OK
	}
}

# Attack succeeds, not caught
character_event = {
	id = prez.213
	desc = {
		text = attack_herald_cynical_succ
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = cynical
					trait = mystic
					NOT = { piety = 0 }
				}
			}
		}
	}
	desc = {
		text = attack_herald_craven_succ
		trigger = {
			event_target:ctarget = {
				trait = craven
			}
		}
	}
	desc = {
		text = attack_herald_lunatic_succ
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = lunatic
					trait = possessed
					trait = depressed
					trait = stressed
				}
			}
		}
	}
	desc = {
		text = attack_herald_lustful_succ
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = lustful
					trait = seducer
					trait = seductress
					trait = hedonist
					trait = homosexual
					any_child = {
						OR = {
							trait = bastard
							trait = legit_bastard
						}
					}
				}
			}
		}
	}
	desc = {
		text = attack_herald_deceitful_succ
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = paranoid
					trait = deceitful
					trait = schemer
				}
			}
		}
	}
	desc = {
		text = attack_herald_arbitrary_succ
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = arbitrary
					trait = cruel
					trait = impaler
				}
			}
		}
	}
	desc = {
		text = attack_herald_trusting_succ
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = trusting
					trait = kind
				}
			}
		}
	}
	desc = {
		text = attack_herald_cursed_succ
		trigger = {
			event_target:ctarget = {
				OR = {
					trait = dwarf
					trait = ugly
					trait = harelip
					trait = hunchback
					trait = clubfooted
					trait = lisp
					trait = stutter
					trait = slow
					trait = imbecile
					trait = inbred
					trait = weak
				}
			}
		}
	}
	desc = {
		text = attack_herald_generic_succ
	}
	is_triggered_only = yes
	notification = yes

	immediate = {
		event_target:ctarget = { reverse_opinion = { who = ROOT modifier = attack_heralds years = 2 } }
	}
	
	option = {
		name = OK
	}
}

# strip all claims on the presidency
character_event = {
	id = prez.300
	desc = DEBUG
	hide_window = yes
	
	trigger = {
		NOT = { has_landed_title = d_americanist }
		has_claim = d_americanist
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	immediate = {
		remove_claim = d_americanist
	}
	
	option = {
		name = OK
	}
}

#The Presidency Restored
narrative_event = {
	id = prez.301
	title = EVTNAME_presidency_restored
	desc = EVTDESC_presidency_restored
	border = GFX_event_narrative_frame_religion
	picture = GFX_evt_coronation
	is_triggered_only = yes
	only_rulers = yes
	religion = americanist
	
	option = {
		name = EVTOPTA_presidency_restored
		trigger = {
			has_landed_title = d_americanist
		}
		if = {
			limit = { NOT = { dynasty = none } }
			give_nickname = nick_lastname
		}
		add_trait = president
	}
	
	option = {
		name = EVTOPTB_presidency_restored
		trigger = {
			NOT = { has_landed_title = d_americanist }
		}
	}
}