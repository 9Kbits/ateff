# Events for electing the President
# by Sam

namespace = president

# Send out notifications of President death
character_event = {
	id = president.1
	desc = "President is dead"
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		#religion = americanist
		#controls_religion = yes
		has_landed_title = d_americanist
	}
	
	immediate = {
		k_papal_state = { holder_scope = { character_event = { id = president.2 } } }
		k_papal_state = { holder_scope = { character_event = { id = president.4 days = 3 } } }
	}
	
	option = {
		name = "Shouldn't see this"
	}
}

character_event = {
	id = president.2
	desc = "President is dead"
	is_triggered_only = yes
	hide_window = yes

	option = {
		name = "Shouldn't see this"
		k_papal_state = { holder_scope = { set_variable = { which = "num_president_candidates" value = 0 } } }
		#any_independent_ruler = {
		#	limit = {
		#		religion = americanist
		#		is_adult = yes
		#	}
		#	character_event = { id = president.3 }
		#}
		any_independent_ruler = {
			any_realm_character = {
				limit = {
					religion = americanist
					is_adult = yes
					#higher_tier_than = COUNT # Dukes and above
				}
				character_event = { id = president.3 }
			}
		}
	}
}

# Announce death of the President
character_event = {
	id = president.3
	desc = "president.3.desc"
	picture = GFX_evt_bishop

	is_triggered_only = yes
	option = {
		name = "president.3.optA" # Run for election
		ai_chance = {
			factor = 1
			modifier = {
				factor = 5
				trait = ambitious
			}
			modifier = {
				factor = 2
				trait = zealous
			}
		}
		set_character_flag = running_for_president
		k_papal_state = { holder_scope = { change_variable = { which = "num_president_candidates" value = 1 } } }
	}
	option = {
		name = "president.3.optB" # Don't run
		ai_chance = {
			factor = 2
			modifier = {
				factor = 2
				trait = content
			}
			modifier = {
				factor = 1.5
				trait = cynical
			}
		}
		clr_character_flag = running_for_president
		set_character_flag = not_running_for_president
	}
}

# Filtering loop (run by Pope)
character_event = {
	id = president.4
	desc = "Filtering loop"
	is_triggered_only = yes
	
	option = {
		name = "Continue"
		trigger = {
			check_variable = { which = "num_president_candidates" value = 4 }
		}
		#any_independent_ruler = {
		#	limit = {
		#		religion = americanist
		#		has_character_flag = running_for_president
		#	}
		#	k_papal_state = { holder_scope = { character_event = { id = president.5 } } }
		#}
		any_independent_ruler = {
			any_realm_character = {
				limit = {
					religion = americanist
					#higher_tier_than = COUNT # Dukes and above
					has_character_flag = running_for_president
				}
				k_papal_state = { holder_scope = { character_event = { id = president.5 } } }
			}
		}
		character_event = { id = president.4 days = 2 }
	}
	
	option = {
		name = "Finished"
		trigger = {
			NOT = { check_variable = { which = "num_president_candidates" value = 5 } }
		}
		# Inform players of candidates
		any_playable_ruler = {
			limit = { religion = americanist }
			character_event = { id = president.10 }
		}
	}
}

# Filter out a character
character_event = {
	id = president.5
	desc = "Filtering candidates"
	is_triggered_only = yes
	
	option = {
		name = "Keep"
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1.5
				FROM = { diplomacy = 10 }
			}
			modifier = {
				factor = 1.5
				FROM = { intrigue = 10 }
			}
			modifier = {
				factor = 2
				FROM = { learning = 10 }
			}
			modifier = {
				factor = 1.5
				FROM = { diplomacy = 20 }
			}
			modifier = {
				factor = 1.5
				FROM = { intrigue = 20 }
			}
			modifier = {
				factor = 2
				FROM = { learning = 20 }
			}
			modifier = {
				factor = 1.25
				FROM = { tier = baron }
			}
			modifier = {
				factor = 1.5
				FROM = { tier = count }
			}
			modifier = {
				factor = 1.75
				FROM = { tier = duke }
			}
			modifier = {
				factor = 2
				FROM = { tier = king }
			}
			modifier = {
				factor = 2.25
				FROM = { tier = emperor }
			}
			modifier = {
				factor = 0.5
				FROM = { NOT = { prestige = 0 } }
			}
			modifier = {
				factor = 1.1
				FROM = { prestige = 500 }
			}
			modifier = {
				factor = 1.2
				FROM = { prestige = 1000 }
			}
			modifier = {
				factor = 1.3
				FROM = { prestige = 2500 }
			}
			modifier = {
				factor = 1.4
				FROM = { prestige = 5000 }
			}
			modifier = {
				factor = 1.5
				FROM = { prestige = 10000 }
			}
		}
		FROM = { set_character_flag = filter_run }
	}
	option = {
		name = "Don't keep"
		ai_chance = {
			factor = 5
		}
		FROM = {
			clr_character_flag = running_for_president
			set_character_flag = dropped_from_election
			character_event = { id = president.9 }
		}
		change_variable = { which = "num_president_candidates" value = -1 }
	}
}

# Eliminated from election
character_event = {
	id = president.9
	desc = "president.9.desc"
	is_triggered_only = yes

	option = {
		name = "president.9.optA"
	}
}

# Show all President candidates
character_event = {
	id = president.10
	desc = "president.10.desc"
	is_triggered_only = yes

	option = {
		name = "president.10.optA"
		#any_independent_ruler = {
		#	limit = {
		#		religion = americanist
		#		has_character_flag = running_for_president
		#	}
		#	custom_tooltip = { text = TOOLTIPPRESIDENTCANDIDATE }
		#}
		any_independent_ruler = {
			any_realm_character = {
				limit = {
					religion = americanist
					#higher_tier_than = COUNT # Dukes and above
					has_character_flag = running_for_president
				}
				custom_tooltip = { text = TOOLTIPPRESIDENTCANDIDATE }
			}
		}
	}
}